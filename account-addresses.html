<!doctype html>
<html class="no-js" lang="zxx">
    <head>
        <title>Account - QuackCommerce.com</title>
        <link rel="icon" type="image/png" href="images/logo/site-logo-only.jpg">
        <!-- MATERIAL DESIGN ICONIC FONT -->
		<link rel="stylesheet" href="fonts/material-design-iconic-font/css/material-design-iconic-font.min.css">
        <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" >
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.css" integrity="sha512-UTNP5BXLIptsaj5WdKFrkFov94lDx+eBvbKyoe1YAfjeRPC+gT5kyZ10kOHCfNZqEui1sxmqvodNUx3KbuYI/A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdn.usebootstrap.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <link rel="stylesheet" href="css/helper.css">
        <link rel="stylesheet" href="style.css">
        <script>
            if (sessionStorage.getItem('username') === 'guest') {
                sessionStorage.setItem('redirectToPage', 'account-addresses.html')
                window.location.href = 'sign-in.html';
            }
        </script>
    </head>
    <body>
        <!-- Begin Body Wrapper -->
        <div class="body-wrapper">
            <!-- Begin Header Area -->
            <header class="header">
                <!-- Begin Header Top Area -->
                <div class="header-top">
                    <div class="container">
                        <div class="ht-menu">
                            <span>Telephone Enquiry: 1-(800)-876-543</span>
                            <ul>
                                <li><a href="index.html">Home</a></li>
                                <li><a href="account-basic-info.html">My Account</a></li>
                                <li><a href="shopping-cart.html">Cart</a></li>
                                <li><a id="sign-in-link" href="sign-in.html">Sign In</a></li>    
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Header Top Area End Here -->
                <!-- Begin Header Middle Area -->
                <div class="header-middle">
                    <div class="container">
                        <div class="row">
                            <div class="col-3">
                                <div class="logo">
                                    <a href="index.html">
                                        <img src="images/logo/site-logo-only.jpg" alt="" style="width: 18%;">
                                        <span>QuackCommerce</span> 
                                    </a>
                                </div>
                            </div>
                            <div class="col-9">
                                <div class="hm-searchbox-area">
                                    <div class="hm-searchbox">
                                        <form id="searchForm">
                                            <select id="categorySelect">
                                                <option value="0">All</option>                         
                                                <option value="1">Laptops & Tablets</option>                     
                                                <option value="2">Electronics & Accessories</option>    
                                                <option value="3">Printers</option>
                                            </select>
                                            <input id="searchInput" type="text" placeholder="Search for anything at QuackCommerce online">
                                        </form>                                                                           
                                    </div>
                                    <p><a href="account-basic-info.html">Hello, <span id="greet-user">guest</span></a></p>
                                    <div class="cart-container">
                                        <a href="shopping-cart.html">
                                            <img src="images/icon/cart.png" alt="" width="50px">
                                            <span id="cart-number" class="cart-number">0</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Header Middle Area End Here -->
                <!-- Begin Header Bottom Area -->
                <div class="header-bottom header-sticky">
                    <div class="container">
                        <div class="hb-menu">
                            <nav>
                                <ul>
                                    <li class="dropdown-holder"><a href="product-grid-category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets">Laptops & Tablets</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="product-grid-category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets&subcategoryId=1&subcategoryName=Laptops">Laptops</a></li>
                                            <li><a href="product-grid-category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets&subcategoryId=2&subcategoryName=Tablets">Tablets</a></li>
                                        </ul>
                                    </li>
                                    <li class="dropdown-holder"><a href="product-grid-category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories">Electronics & Accessories</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="product-grid-category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=3&subcategoryName=Keyboards%20%26%20Mice">Keyboards & Mice</a></li>
                                            <li><a href="product-grid-category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=4&subcategoryName=Audio">Audio</a></li>
                                            <li><a href="product-grid-category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=5&subcategoryName=Hard%20Drives,%20SSDs%20%26%20Storage">Hard Drives, SSDs & Storage</a></li>
                                        </ul>
                                    </li>
                                    <li class="dropdown-holder"><a href="product-grid-category.html?categoryId=3&categoryName=Printers">Printers</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="product-grid-category.html?categoryId=3&categoryName=Printers&subcategoryId=6&subcategoryName=Inkjet%20Printers">Inkjet Printers</a></li>
                                            <li><a href="product-grid-category.html?categoryId=3&categoryName=Printers&subcategoryId=7&subcategoryName=Laser%20Printers">Laser Printers</a></li>
                                        </ul>
                                    </li>
                                    <div class="hb-right">
                                        <li><a href="product-grid-general.html?searchType=New%20Arrivals">New Arrivals</a></li>
                                        <li><a href="product-grid-general.html?searchType=Best%20Sellers">Best Sellers</a></li>
                                    </div>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
                <!-- Header Bottom Area End Here -->
            </header>
            <!-- Header Area End Here -->
            <!-- Begin Breadcrumb Area -->
            <div class="breadcrumb-area mb-20">
                <div class="container">
                    <div class="breadcrumb-content">
                        <ul>
                            <li><a href="index.html">Home</a></li>
                            <li style="color: #808080;">Your Account</li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Breadcrumb Area End Here -->
            <!-- Begin Account Area -->
            <div class="account-area mb-50">
                <div class="container">
                    <div class="row">
                        <div class="col-3">
                            <div class="side-tab-block">
                                <div class="side-tab-header">
                                    <h3 style="font-weight: bold;">Manage Account</h3>
                                </div>
                                <hr>
                                <div class="side-tab"><a href="account-basic-info.html">Personal Info</a></div>
                                <div class="side-tab"><a href="account-addresses.html">Your Addresses</a></div>
                                <div class="side-tab"><a href="account-security.html">Security</a></div>
                            </div>
                            <div class="side-tab-block">
                                <div class="side-tab-header">
                                    <h3 style="font-weight: bold;">Other Info</h3>
                                </div>
                                <hr>
                                <div class="side-tab"><a href="account-orders.html">Order History</a></div>
                            </div>
                            <div class="side-tab-block">
                                <div class="side-tab-header">
                                    <h3 style="font-weight: bold;">Customer Service</h3>
                                </div>
                                <hr>
                                <div class="side-tab"><a href="">Help</a></div>
                                <div class="side-tab"><a href="">Terms of Use</a></div>
                            </div>
                        </div>
                        <div class="col-7">
                            <div class="section-title">
                                <h2>Your Addresses</h2>
                            </div><br><br>
                            <div id="no-primary" style="color: red;"></div>
                            <div id="addressContainer" style="margin-bottom: 20px;"></div>
                            <button type="button" class="my-button-inverse add-address-button" data-toggle="modal" data-target="#addressModal-add">Add address</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Account Area End Here -->
            <!-- Begin Scroll Top  -->
            <div id="scrollToTop" class="mt-100">
                back to top
            </div>
            <!-- Scroll Top End Here -->
            <!-- Begin Footer Area -->
            <div class="footer pt-10 pb-10">
                <div class="container">
                    <div class="footer-wrap">
                        <div>
                            <ul style="margin-bottom: 20px;">
                                <li><a href="deals.html">Deals</a></li>
                                <li><a href="product-grid-general.html?searchType=New%20Arrivals">New products</a></li>
                                <li><a href="product-grid-general.html?searchType=Best%20Sellers">Best sales</a></li>
                                <li><a href="sign-in.html">Check Your Account</a></li>
                                <li><a href="sign-up.html">Be Our Customer</a></li>
                                <li><a href="account-orders.html">Track Your Orders</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                            </ul>
                            <label style="color: #fff;" for="fname">Payment by</label>
                            <img src="images/icon/Credit-Card-Icons.jpg" width="20%" alt="">
                        </div>   
                        <div>
                            <span style="font-size: 12px;">&copy 2024 QuackCommerce.com. All Rights Reserved.</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer Area End Here -->
        </div>
        <!-- Body Wrapper End Here -->
        <!-- Modal -->
        <div class="modal" id="addressModal-edit" tabindex="-1" data-backdrop="static" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit Address</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form action="#" class="address-form">
                            <input type="hidden" class="address-id">
                            <div class="row">
                                <div class="col-12">
                                    <div class="edit-block">
                                        <div class="edit-div">
                                            <label for="">Country</label>
                                        </div>
                                        <span style="color: #808080;">Malaysia</span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <label for="">Street Address</label>
                                    <input type="text" name="streetAddress" placeholder="Enter street address" required>
                                </div>
                                <div class="col-6">
                                    <label for="">City</label>
                                    <input type="text" name="city" placeholder="Enter city" required>
                                </div>                                 
                                <div class="col-6">
                                    <label for="">Zipcode</label>
                                    <input type="text" name="zipcode" placeholder="Enter zipcode" required>
                                </div>
                                <div class="col-12">
                                    <label for="">State</label>
                                    <select style="width: 100%;">
                                        <option value="">Please select a state</option>
                                        <option value="Johor">Johor</option>
                                        <option value="Kedah">Kedah</option>
                                        <option value="Kelantan">Kelantan</option>
                                        <option value="Melaka">Melaka (Malacca)</option>
                                        <option value="Negeri Sembilan">Negeri Sembilan</option>
                                        <option value="Pahang">Pahang</option>
                                        <option value="Perak">Perak</option>
                                        <option value="Perlis">Perlis</option>
                                        <option value="Pulau Pinang">Pulau Pinang (Penang)</option>
                                        <option value="Sabah">Sabah</option>
                                        <option value="Sarawak">Sarawak</option>
                                        <option value="Selangor">Selangor</option>
                                        <option value="Terengganu">Terengganu</option>
                                    </select>
                                </div>           
                            </div>
                            <p style="display: flex; align-items: center;"><input style="margin-right: 10px;" type="checkbox" name="primary"><span>Set this address as primary address</span></p>
                        </form>
                        <div class="error-message"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary my-button update-button">Update</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Modal -->
        <div class="modal" id="addressModal-add" tabindex="-1" data-backdrop="static" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Add Address</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form action="#" class="address-form">
                            <div class="row">
                                <div class="col-12">
                                    <div class="edit-block">
                                        <div class="edit-div">
                                            <label for="">Country</label>
                                        </div>
                                        <span style="color: #808080;">Malaysia</span>
                                    </div>
                                </div>
                                <div class="col-12">
                                    <label for="">Street Address</label>
                                    <input type="text" placeholder="Enter street address" name="streetAddress" required>
                                </div>
                                <div class="col-6">
                                    <label for="">City</label>
                                    <input type="text" placeholder="Enter city" name="city" required>
                                </div>                                 
                                <div class="col-6">
                                    <label for="">Zipcode</label>
                                    <input type="text" placeholder="Enter zipcode" name="zipcode" required>
                                </div>
                                <div class="col-12">
                                    <label for="">State</label>
                                    <select style="width: 100%;">
                                        <option value="">Please select a state</option>
                                        <option value="Johor">Johor</option>
                                        <option value="Kedah">Kedah</option>
                                        <option value="Kelantan">Kelantan</option>
                                        <option value="Melaka">Melaka (Malacca)</option>
                                        <option value="Negeri Sembilan">Negeri Sembilan</option>
                                        <option value="Pahang">Pahang</option>
                                        <option value="Perak">Perak</option>
                                        <option value="Perlis">Perlis</option>
                                        <option value="Pulau Pinang">Pulau Pinang (Penang)</option>
                                        <option value="Sabah">Sabah</option>
                                        <option value="Sarawak">Sarawak</option>
                                        <option value="Selangor">Selangor</option>
                                        <option value="Terengganu">Terengganu</option>
                                    </select>
                                </div>           
                            </div>
                            <p style="display: flex; align-items: center;"><input style="margin-right: 10px;" type="checkbox" name="primary"><span>Set this address as primary address</span></p>
                        </form>
                        <div class="error-message"></div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary my-button save-button">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha512-jGsMH83oKe9asCpkOVkBnUrDDTp8wl+adkB2D+//JtlxO4SrLoJdhbOysIFQJloQFD+C4Fl1rMsQZF76JjV0eQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdn.usebootstrap.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js" integrity="sha512-bPs7Ae6pVvhOSiIcyUClR7/q2OAsRiovw4vAkX+zJbw3ShAeeqezq50RIIcIURq7Oa20rW2n2q+fyXBNcU9lrw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="js/main.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {

                checkSignInStatus();
                getCartNumber();

                const userId = sessionStorage.getItem('userId'); 
                const addressContainer = document.querySelector('#addressContainer');

                const modalFormEdit = document.querySelector('#addressModal-edit .address-form');
                const modalFormAdd = document.querySelector('#addressModal-add .address-form');
                
                // load user addresses
                fetch(`http://localhost:8080/users/${userId}/addresses`)
                    .then(response => {
                        return response.json()
                    })
                    .then(addresses => {
                        let hasPrimaryAddress = false;

                        addresses.forEach((address, index) => {
                            addressContainer.innerHTML += `
                                <div class="address-block">
                                    <div class="edit-block">
                                        <div class="edit-div">
                                            <label for="">Address</label>
                                            <div>
                                                <span style=" font-size: 16px; padding-right: 10px;">${address.primary ? 'Primary' : ''}</span>
                                                <button type="button" class="my-button-inverse edit-button" data-toggle="modal" data-target="#addressModal-edit" data-index="${index}">Edit</button> 
                                                <button type="button" class="my-button-inverse remove-button" data-index="${index}">Remove</button> 
                                            </div>
                                        </div>
                                        <span style="color: #808080;">Address ${index + 1}</span>
                                    </div>
                                    <div class="details-block">
                                        <div style="font-size: 14px;">${address.streetAddress}</div>
                                        <div style="font-size: 14px;">${address.city}</div>
                                        <div style="font-size: 14px;">${address.zipcode}</div>
                                        <div style="font-size: 14px;">${address.state}</div>
                                        <div style="color: #808080;">Malaysia</div>
                                    </div>
                                </div>
                            `;

                            if (address.primary) {
                                hasPrimaryAddress = true; // Set the flag to true if a primary address is found
                            }

                        });

                        if (!hasPrimaryAddress) {
                            document.getElementById('no-primary').textContent = 'No primary address set';
                        }

                        // "edit" button eveent
                        const editButtons = document.querySelectorAll('.edit-button');
                        editButtons.forEach(button => {
                            button.addEventListener('click', function() {
                                const index = parseInt(this.getAttribute('data-index'));
                                const selectedAddress = addresses[index];

                                // Set values in the modal form fields
                                modalFormEdit.querySelector('.address-id').value = selectedAddress.id;
                                modalFormEdit.querySelector('input[name="streetAddress"]').value = selectedAddress.streetAddress;
                                modalFormEdit.querySelector('input[name="city"]').value = selectedAddress.city;
                                modalFormEdit.querySelector('input[name="zipcode"]').value = selectedAddress.zipcode;
                                modalFormEdit.querySelector('select').value = selectedAddress.state;

                                document.querySelector('#addressModal-edit .error-message').textContent = '';

                            });
                        });

                        // "update" button event for edit-modal
                        const updateButton = document.querySelector('#addressModal-edit .update-button');
                        updateButton.addEventListener('click', function() {

                            const addressId = modalFormEdit.querySelector('.address-id').value;
                            const updatedStreetAddress = modalFormEdit.querySelector('input[name="streetAddress"]').value;
                            const updatedCity = modalFormEdit.querySelector('input[name="city"]').value;
                            const updatedZipcode = modalFormEdit.querySelector('input[name="zipcode"]').value;
                            const updatedState = modalFormEdit.querySelector('select').value;
                            const isPrimary = modalFormEdit.querySelector('input[name="primary"]').checked;

                            if (addressId !== '' && updatedStreetAddress !== '' && updatedCity !== '' && updatedZipcode !== '' && updatedState !== '') {
                                let updatedAddress = {
                                    id: addressId,
                                    streetAddress: updatedStreetAddress,
                                    city: updatedCity,
                                    zipcode: updatedZipcode,
                                    state: updatedState,
                                    primary: isPrimary
                                };

                                // update address
                                fetch(`http://localhost:8081/users/${userId}/addresses/${addressId}`, {
                                    method: 'PUT',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify(updatedAddress)
                                })
                                    .then(response => {
                                        if (!response.ok) {
                                            return response.json().then(errorData => {
                                                throw new Error(errorData.message);
                                            });
                                        }
                                    })
                                    .then(() => {
                                        window.location.reload();
                                    })
                                    .catch(error => {
                                        console.error(error);
                                    });

                            } else {
                                // Handle the case where any field is null
                                document.querySelector('#addressModal-edit .error-message').innerText = 'Please fill in all fields';
                            }
                        });

                        // remove address event
                        const removeButtons = document.querySelectorAll('.remove-button');
                        removeButtons.forEach(button => {
                            button.addEventListener('click', function() {
                                const index = parseInt(this.getAttribute('data-index'));
                                const selectedAddress = addresses[index];

                                // delete an address
                                fetch(`http://localhost:8081/users/${userId}/addresses/${selectedAddress.id}`, {
                                        method: 'DELETE',
                                        headers: {
                                            'Content-Type': 'application/json',
                                        },
                                    })
                                    .then(response => {
                                        if (!response.ok) {
                                            return response.json().then(errorData => {
                                                throw new Error(errorData.message);
                                            });
                                        }
                                    })
                                    .then(() => {
                                        
                                        window.location.reload();
                                    })
                                    .catch(error => {
                                        console.error(error);
                                    });

                            });
                        });

                    })
                    .catch(error => {
                        console.error(error);
                    });

                // "add address" button
                const addAddressButton = document.querySelector('.add-address-button');
                addAddressButton.addEventListener('click', function() {

                    document.querySelector('#addressModal-add .address-form').reset();
                    document.querySelector('#addressModal-add .error-message').textContent = '';
                });

                // "save-changes" button for add-modal
                const saveButton = document.querySelector('#addressModal-add .save-button');
                saveButton.addEventListener('click', function() {

                    const newStreetAddress = modalFormAdd.querySelector('input[name="streetAddress"]').value;
                    const newCity = modalFormAdd.querySelector('input[name="city"]').value;
                    const newZipcode = modalFormAdd.querySelector('input[name="zipcode"]').value;
                    const newState = modalFormAdd.querySelector('select').value;
                    const isPrimary = modalFormAdd.querySelector('input[name="primary"]').checked; // Get the value of the primary checkbox

                    if (newStreetAddress !== '' && newCity !== '' && newZipcode !== '' && newState !== '') {
                        let newAddress = {
                            streetAddress: newStreetAddress,
                            city: newCity,
                            zipcode: newZipcode,
                            state: newState,
                            primary: isPrimary
                        };

                        // add a new address
                        fetch(`http://localhost:8081/users/${userId}/addresses`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify(newAddress)
                            })
                            .then(response => {
                                if (!response.ok) {
                                    return response.json().then(errorData => {
                                        throw new Error(errorData.message);
                                    });
                                }
                                return response.json();
                            })
                            .then(() => {
                                window.location.reload();
                            })
                            .catch(error => {
                                console.error(error);
                            });

                    } else {
                        // Handle the case where any field is null
                        document.querySelector('#addressModal-add .error-message').innerText = 'Please fill in all fields';
                    }
                });

            });
        </script>
    </body>
</html>