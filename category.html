<!doctype html>
<html class="no-js" lang="zxx">
    <head>
        <title>E-Commerce</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.css" integrity="sha512-UTNP5BXLIptsaj5WdKFrkFov94lDx+eBvbKyoe1YAfjeRPC+gT5kyZ10kOHCfNZqEui1sxmqvodNUx3KbuYI/A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdn.usebootstrap.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <link rel="stylesheet" href="css/helper.css">
        <link rel="stylesheet" href="style.css"> 
        <style>
            .icon-control {
                margin-top: 5px;
                float: right;
                font-size: 80%;
            }



            .btn-light {
                background-color: #fff;
                border-color: #e4e4e4;
            }

            .list-menu {
                list-style: none;
                margin: 0;
                padding-left: 0;
            }
            .list-menu a {
                color: #343a40;
            }

            .card-product-grid .info-wrap {
                overflow: hidden;
                padding: 18px 20px;
            }

            [class*='card-product'] a.title {
                color: #212529;
                display: block;
            }

            .card-product-grid:hover .btn-overlay {
                opacity: 1;
            }
            .card-product-grid .btn-overlay {
                -webkit-transition: .5s;
                transition: .5s;
                opacity: 0;
                left: 0;
                bottom: 0;
                color: #fff;
                width: 100%;
                padding: 5px 0;
                text-align: center;
                position: absolute;
                background: rgba(0, 0, 0, 0.5);
            }
            .img-wrap {
                overflow: hidden;
                position: relative;
            }
        </style>
    </head>
    <body>
    <!--[if lt IE 8]>
		<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
	<![endif]-->
        <!-- Begin Body Wrapper -->
        <div class="body-wrapper">
            <!-- Begin Header Area -->
            <header class="header">
                <!-- Begin Header Top Area -->
                <div class="header-top">
                    <div class="container">
                        <div class="ht-menu">
                            <span>Telephone Enquiry:(+123) 123 321 345</span>
                            <ul>
                                <li><a href="index.html">Home</a></li>
                                <li><a href="account.html">My Account</a></li>
                                <li><a href="shopping-cart.html">Cart</a></li>
                                <li><a href="checkout.html">Checkout</a></li>
                                <li><a id="sign-in-link" href="sign-in.html">Sign In</a></li>    
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Header Top Area End Here -->
                <!-- Begin Header Middle Area -->
                <div class="header-middle">
                    <div class="container">
                        <div class="row">
                            <div class="col-3">
                                <div class="logo">
                                    <a href="index.html">
                                        <img src="images/logo/site-logo.jpg" alt="">
                                    </a>
                                </div>
                            </div>
                            <div class="col-9 hm-searchbox-area">
                                <div class="hm-searchbox">
                                    <form action="#">
                                        <select>
                                            <option value="0">All</option>                         
                                            <option value="10">Laptops & Tablets</option>                     
                                            <option value="10">Electronics & Accessories</option>    
                                            <option value="10">Printers</option>
                                        </select>
                                        <input type="text" placeholder="Enter your search key ...">
                                    </form>
                                </div>
                                <p>Hello, <span id="greet-user">guest</span></p>
                                <div class="cart-container">
                                    <a href="shopping-cart.html">
                                        <img src="images/icon/cart.png" alt="" width="50px">
                                        <span id="cart-number" class="cart-number">0</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Header Middle Area End Here -->
                <!-- Begin Header Bottom Area -->
                <div class="header-bottom header-sticky">
                    <div class="container">
                        <!-- Begin Header Bottom Menu Area -->
                        <div class="hb-menu">
                            <nav>
                                <ul>
                                    <li class="dropdown-holder"><a href="category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets">Laptops & Tablets</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets&subcategoryId=1&subcategoryName=Laptops">Laptops</a></li>
                                            <li><a href="category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets&subcategoryId=2&subcategoryName=Tablets">Tablets</a></li>
                                        </ul>
                                    </li>
                                    <li class="dropdown-holder"><a href="category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories">Electronics & Accessories</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=3&subcategoryName=Keyboards%20%26%20Mice">Keyboards & Mice</a></li>
                                            <li><a href="category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=4&subcategoryName=Audio">Audio</a></li>
                                            <li><a href="category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=5&subcategoryName=Hard%20Drives,%20SSDs%20%26%20Storage">Hard Drives, SSDs & Storage</a></li>
                                        </ul>
                                    </li>
                                    <li class="dropdown-holder"><a href="category.html?categoryId=3&categoryName=Printers">Printers</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="category.html?categoryId=3&categoryName=Printers&subcategoryId=6&subcategoryName=Inkjet%20Printers">Inkjet Printers</a></li>
                                            <li><a href="category.html?categoryId=3&categoryName=Printers&subcategoryId=7&subcategoryName=Laser%20Printers">Laser Printers</a></li>
                                        </ul>
                                    </li>
                                    <div class="hb-right">
                                        <li><a href="#">Featured</a></li>
                                        <li><a href="#">New Arrivals</a></li>
                                        <li><a href="#">Best Sellers</a></li>
                                    </div>
                                </ul>
                            </nav>
                        </div>
                        <!-- Header Bottom Menu Area End Here -->
                    </div>
                </div>
                <!-- Header Bottom Area End Here -->
            </header>
            <!-- Header Area End Here -->
            <!-- Begin Breadcrumb Area -->
            <div class="breadcrumb-area">
                <div class="container">
                    <div class="breadcrumb-content">
                        <ul>
                            <li><a href="index.html">Home</a></li>
                            <li id="category-name"></li>
                            <li id="subcategory-name"></li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Breadcrumb Area End Here -->
            <!-- Begin Content Wrapper Area -->
            <div class="content-wrapper mb-50">
                <div class="container">
                    <div class="row">
                        <div class="col-3">
                            <div class="card">
                                <article class="filter-group">
                                    <header class="card-header">
                                        <a href="#" data-toggle="collapse" data-target="#collapse_manufacturers" aria-expanded="true" class="">
                                            <i class="icon-control fa fa-chevron-down"></i>
                                            <h6 class="title">Manufacturers</h6>
                                        </a>
                                    </header>
                                    <div class="filter-content collapse show" id="collapse_manufacturers">
                                        <div class="card-body">
                                            <!-- manufacturer options will be inserted here -->
                                        </div> <!-- card-body.// -->
                                    </div>
                                </article> <!-- filter-group .// -->
                                <article class="filter-group">
                                    <header class="card-header">
                                        <a href="#" data-toggle="collapse" data-target="#collapse_3" aria-expanded="true" class="">
                                            <i class="icon-control fa fa-chevron-down"></i>
                                            <h6 class="title">Price range </h6>
                                        </a>
                                    </header>
                                    <div class="filter-content collapse show" id="collapse_3" style="">
                                        <div class="card-body">
                                            <input type="range" class="custom-range" min="0" max="100" name="">
                                            <div class="form-row">
                                            <div class="form-group col-md-6">
                                              <label>Min</label>
                                              <input class="form-control" placeholder="$0" type="number">
                                            </div>
                                            <div class="form-group text-right col-md-6">
                                              <label>Max</label>
                                              <input class="form-control" placeholder="$1,0000" type="number">
                                            </div>
                                            </div> <!-- form-row.// -->
                                            <button class="btn btn-block btn-primary">Apply</button>
                                        </div><!-- card-body.// -->
                                    </div>
                                </article> <!-- filter-group .// -->
                                <article class="filter-group">
                                    <header class="card-header">
                                        <a href="#" data-toggle="collapse" data-target="#collapse_4" aria-expanded="true" class="">
                                            <i class="icon-control fa fa-chevron-down"></i>
                                            <h6 class="title">Sizes </h6>
                                        </a>
                                    </header>
                                    <div class="filter-content collapse show" id="collapse_4" style="">
                                        <div class="card-body">
                                          <label class="checkbox-btn">
                                            <input type="checkbox">
                                            <span class="btn btn-light"> XS </span>
                                          </label>
                            
                                          <label class="checkbox-btn">
                                            <input type="checkbox">
                                            <span class="btn btn-light"> SM </span>
                                          </label>
                            
                                          <label class="checkbox-btn">
                                            <input type="checkbox">
                                            <span class="btn btn-light"> LG </span>
                                          </label>
                            
                                          <label class="checkbox-btn">
                                            <input type="checkbox">
                                            <span class="btn btn-light"> XXL </span>
                                          </label>
                                    </div><!-- card-body.// -->
                                    </div>
                                </article> <!-- filter-group .// -->
                                <article class="filter-group">
                                    <header class="card-header">
                                        <a href="#" data-toggle="collapse" data-target="#collapse_5" aria-expanded="false" class="">
                                            <i class="icon-control fa fa-chevron-down"></i>
                                            <h6 class="title">More filter </h6>
                                        </a>
                                    </header>
                                    <div class="filter-content collapse in" id="collapse_5" style="">
                                        <div class="card-body">
                                            <label class="custom-control custom-radio">
                                              <input type="radio" name="myfilter_radio" checked="" class="custom-control-input">
                                              <div class="custom-control-label">Any condition</div>
                                            </label>
                            
                                            <label class="custom-control custom-radio">
                                              <input type="radio" name="myfilter_radio" class="custom-control-input">
                                              <div class="custom-control-label">Brand new </div>
                                            </label>
                            
                                            <label class="custom-control custom-radio">
                                              <input type="radio" name="myfilter_radio" class="custom-control-input">
                                              <div class="custom-control-label">Used items</div>
                                            </label>
                            
                                            <label class="custom-control custom-radio">
                                              <input type="radio" name="myfilter_radio" class="custom-control-input">
                                              <div class="custom-control-label">Very old</div>
                                            </label>
                                        </div><!-- card-body.// -->
                                    </div>
                                </article> <!-- filter-group .// -->
                            </div> <!-- card.// -->
                        </div>
                        <div class="col-9">
                            <div class="shop-top-bar">
                                <div class="quantity-select">
                                    <label>Sort by</label>
                                    <select>
                                        <option>Relevance</option>
                                        <option>Price: Low to High</option>
                                        <option>Price: High to Low</option>
                                        <option>Newest Arrivals</option>
                                    </select>
                                </div>
                            </div>
                            <div class="shop-products-wrapper">
                                <div class="shop-product-area">
                                    <div class="row">
                                        <!-- products will be inserted here -->
                                    </div>
                                </div>
                            </div>
                            <div class="paginatoin-area">
                                <div class="row">
                                    <div class="col-6">
                                        <p id="showing-info"></p>
                                    </div>
                                    <div class="col-6">
                                        <ul class="pagination-box">
                                            <!-- pagination navigation will be inserted here -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
            <!-- Content Wrapper Area End Here -->
            <!-- Begin Footer Area -->
            <div class="footer">
                <!-- Begin Footer Static Top Area -->
                <div class="footer-static-top">
                    <div class="container">
                        <!-- Begin Footer Shipping Area -->
                        <div class="footer-shipping pt-60 pb-55 pb-xs-25">
                            <div class="row">
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-sm-55 pb-xs-55">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="images/shipping-icon/1.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>Free Delivery</h2>
                                            <p>And free returns. See checkout for delivery dates.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-sm-55 pb-xs-55">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="images/shipping-icon/2.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>Safe Payment</h2>
                                            <p>Pay with the world's most popular and secure payment methods.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-xs-30">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="images/shipping-icon/3.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>Shop with Confidence</h2>
                                            <p>Our Buyer Protection covers your purchasefrom click to delivery.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-xs-30">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="images/shipping-icon/4.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>24/7 Help Center</h2>
                                            <p>Have a question? Call a Specialist or chat online.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                            </div>
                        </div>
                        <!-- Footer Shipping Area End Here -->
                    </div>
                </div>
                <!-- Footer Static Top Area End Here -->
            </div>
            <!-- Footer Area End Here -->
        </div>
        <!-- Body Wrapper End Here -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha512-jGsMH83oKe9asCpkOVkBnUrDDTp8wl+adkB2D+//JtlxO4SrLoJdhbOysIFQJloQFD+C4Fl1rMsQZF76JjV0eQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdn.usebootstrap.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js" integrity="sha512-bPs7Ae6pVvhOSiIcyUClR7/q2OAsRiovw4vAkX+zJbw3ShAeeqezq50RIIcIURq7Oa20rW2n2q+fyXBNcU9lrw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="js/jquery.meanmenu.min.js"></script>
        <script src="js/main.js"></script>
        <script>
            let currentPage;
            let totalPages;

            document.addEventListener('DOMContentLoaded', function () {

                checkSignInStatus();
                getCartNumber();
                
                const params = new URLSearchParams(window.location.search);
                const categoryName = params.get('categoryName');
                const subcategoryName = params.get('subcategoryName');

                // Get the breadcrumb elements
                let categoryElement = document.querySelector('#category-name');
                let subcategoryElement = document.querySelector('#subcategory-name');

                // Set the breadcrumb content
                if (subcategoryName) {
                    categoryElement.innerHTML = `<a href="category.html?categoryId=${params.get('categoryId')}&categoryName=${categoryName}">${categoryName}</a>`;
                    subcategoryElement.textContent = subcategoryName;
                    subcategoryElement.style.color = '#808080';
                } else if (categoryName) {
                    categoryElement.textContent = categoryName;
                    categoryElement.style.color = '#808080';
                }
                
                const categoryId = params.get('categoryId');
                const subcategoryId = params.get('subcategoryId');

                fetch(`http://localhost:8080/products/categories/${categoryId}/manufacturers`)
                .then(response => response.json())
                .then(data => {
                    let filterGroup = document.querySelector('#collapse_manufacturers .card-body');

                    // Clear the existing content
                    filterGroup.innerHTML = '';

                    let html = '';

                    for (let manufacturer in data) {
                        let count = data[manufacturer];

                        html += `
                            <label class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input">
                                <div class="custom-control-label">
                                    ${manufacturer} <b class="badge badge-pill badge-light float-right">${count}</b>
                                </div>
                            </label>
                        `;
                    }

                    filterGroup.innerHTML = html;

                    if (!sessionStorage.getItem('currentPage')) {
                        sessionStorage.setItem('currentPage', 0);
                    }
                    currentPage = sessionStorage.getItem('currentPage');
                    sessionStorage.removeItem('currentPage');

                    fetchAndRenderProducts(currentPage);

                    })

                .catch(error => console.error('Error:', error));

            });
        
            function fetchAndRenderProducts(page) {
                const params = new URLSearchParams(window.location.search);
                const categoryId = params.get('categoryId');
                const subcategoryId = params.get('subcategoryId');
        
                let apiURL;
                if (subcategoryId !== null) {
                    apiURL = `http://localhost:8080/products/category-subcategory?categoryId=${categoryId}&subcategoryId=${subcategoryId}&page=${page}&size=9`;
                } else {
                    apiURL = `http://localhost:8080/products/category-subcategory?categoryId=${categoryId}&page=${page}&size=9`;
                }
        
                fetch(apiURL)
                    .then(response => response.json())
                    .then(data => {
                        const productsContainer = document.querySelector('.shop-product-area .row');
                        productsContainer.innerHTML = '';
        
                        data.content.forEach(product => {
                            const productElement = document.createElement('div');
                            productElement.className = 'col-4';
                    
                            let starRating = '';
                            for (let i = 1; i <= 5; i++) {
                                const star = document.createElement('span');
                                star.className = 'star';
                                star.textContent = '★';
                                if (i > Math.ceil(2.5)) {
                                    star.classList.add('empty');
                                } else if (i > 2.5) {
                                    star.classList.add('half');
                                }
                                starRating += star.outerHTML;
                            }
                    
                            productElement.innerHTML = `
                                <div class="single-product-wrap">
                                    <div class="product-image">
                                        <a href="product-details.html?product=${product.id}">
                                            <img src="images/product/large-size/${product.name}.jpg">
                                        </a>
                                    </div>
                                    <div class="product-desc">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span class="product-manufacturer">${product.manufacturer}</span>
                                            <span class="star-rating">${starRating}</span>
                                        </div>
                                        <hr>
                                        <p class="product-name"><a href="product-details.html?product=${product.id}">${product.name}</a></p>
                                        <hr>
                                        <span class="product-price">$ ${product.price.toFixed(2)}</span>
                                    </div>
                                </div>
                            `;
                            productsContainer.appendChild(productElement);
                        });
                        
                        // Update the "Showing" info
                        const showingInfo = document.getElementById('showing-info');
                        const startItem = page * 9 + 1;
                        const endItem = Math.min((page + 1) * 9, data.totalElements);
                        showingInfo.textContent = `Showing ${startItem}-${endItem} of ${data.totalElements} item(s)`;
                        
                        const paginationBox = document.querySelector('.pagination-box');
                        totalPages = data.totalPages;
        
                        paginationBox.innerHTML = `<li><a href="#" class="Previous"><i class="fa fa-chevron-left"></i> Previous</a></li>`;
                        
                        for (let i = 1; i <= totalPages; i++) {
                            paginationBox.innerHTML += `<li><a href="#">${i}</a></li>`;
                        }
        
                        paginationBox.innerHTML += `<li><a href="#" class="Next"> Next <i class="fa fa-chevron-right"></i></a></li>`;
                        
                        let prevButton = document.querySelector('.Previous');
                        let nextButton = document.querySelector('.Next');

                        // If on the first page, make the 'Previous' button red
                        if (currentPage == 0) {
                            prevButton.style.color = 'gray';
                            prevButton.style.pointerEvents = 'none';
                        }

                        // If on the last page, disable the 'Next' button and make it gray
                        if (currentPage == totalPages - 1) {
                            nextButton.style.color = 'gray';
                            nextButton.style.pointerEvents = 'none';
                        }
                        
                        paginationBox.addEventListener('click', handlePaginationClick);
                    })
                    .catch(error => {
                        console.error(error);
                    });
            }

            function handlePaginationClick(event) {
                event.preventDefault();
        
                if (event.target.tagName === 'A') {
                    const pageNumber = parseInt(event.target.textContent);
        
                    if (!isNaN(pageNumber)) {

                        sessionStorage.setItem('currentPage', pageNumber - 1);
                        location.reload();
                
                    } else if (event.target.classList.contains('Previous')) {

                        if (currentPage > 0) {
                            sessionStorage.setItem('currentPage', currentPage - 1);
                            location.reload();
                        }
                    } else if (event.target.classList.contains('Next')) {

                        if (currentPage < totalPages - 1) {
                            sessionStorage.setItem('currentPage', currentPage + 1);
                            location.reload();
                        }
                    }
                }
            }
        </script>
    </body>
</html>
