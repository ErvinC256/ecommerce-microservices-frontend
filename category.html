<!doctype html>
<html class="no-js" lang="zxx">
    <head>
        <title>E-Commerce</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.css" integrity="sha512-UTNP5BXLIptsaj5WdKFrkFov94lDx+eBvbKyoe1YAfjeRPC+gT5kyZ10kOHCfNZqEui1sxmqvodNUx3KbuYI/A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdn.usebootstrap.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <link rel="stylesheet" href="css/helper.css">
        <link rel="stylesheet" href="style.css"> 
    </head>
    <body>
    <!--[if lt IE 8]>
		<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
	<![endif]-->
        <!-- Begin Body Wrapper -->
        <div class="body-wrapper">
            <!-- Begin Header Area -->
            <header class="header">
                <!-- Begin Header Top Area -->
                <div class="header-top">
                    <div class="container">
                        <div class="ht-menu">
                            <span>Telephone Enquiry:(+123) 123 321 345</span>
                            <ul>
                                <li><a href="index.html">Home</a></li>
                                <li><a href="account.html">My Account</a></li>
                                <li><a href="shopping-cart.html">Cart</a></li>
                                <li><a href="checkout.html">Checkout</a></li>
                                <li><a id="sign-in-link" href="sign-in.html">Sign In</a></li>    
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Header Top Area End Here -->
                <!-- Begin Header Middle Area -->
                <div class="header-middle">
                    <div class="container">
                        <div class="row">
                            <div class="col-3">
                                <div class="logo">
                                    <a href="index.html">
                                        <img src="images/logo/site-logo.jpg" alt="">
                                    </a>
                                </div>
                            </div>
                            <div class="col-9 hm-searchbox-area">
                                <div class="hm-searchbox">
                                    <form action="#">
                                        <select>
                                            <option value="0">All</option>                         
                                            <option value="10">Laptops & Tablets</option>                     
                                            <option value="10">Electronics & Accessories</option>    
                                            <option value="10">Printers</option>
                                        </select>
                                        <input type="text" placeholder="Enter your search key ...">
                                    </form>
                                </div>
                                <p>Hello, <span id="greet-user">guest</span></p>
                                <div class="cart-container">
                                    <a href="shopping-cart.html">
                                        <img src="images/icon/cart.png" alt="" width="50px">
                                        <span id="cart-number" class="cart-number">0</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Header Middle Area End Here -->
                <!-- Begin Header Bottom Area -->
                <div class="header-bottom header-sticky">
                    <div class="container">
                        <!-- Begin Header Bottom Menu Area -->
                        <div class="hb-menu">
                            <nav>
                                <ul>
                                    <li class="dropdown-holder"><a href="category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets">Laptops & Tablets</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets&subcategoryId=1&subcategoryName=Laptops">Laptops</a></li>
                                            <li><a href="category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets&subcategoryId=2&subcategoryName=Tablets">Tablets</a></li>
                                        </ul>
                                    </li>
                                    <li class="dropdown-holder"><a href="category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories">Electronics & Accessories</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=3&subcategoryName=Keyboards%20%26%20Mice">Keyboards & Mice</a></li>
                                            <li><a href="category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=4&subcategoryName=Audio">Audio</a></li>
                                            <li><a href="category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=5&subcategoryName=Hard%20Drives,%20SSDs%20%26%20Storage">Hard Drives, SSDs & Storage</a></li>
                                        </ul>
                                    </li>
                                    <li class="dropdown-holder"><a href="category.html?categoryId=3&categoryName=Printers">Printers</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="category.html?categoryId=3&categoryName=Printers&subcategoryId=6&subcategoryName=Inkjet%20Printers">Inkjet Printers</a></li>
                                            <li><a href="category.html?categoryId=3&categoryName=Printers&subcategoryId=7&subcategoryName=Laser%20Printers">Laser Printers</a></li>
                                        </ul>
                                    </li>
                                    <div class="hb-right">
                                        <li><a href="#">Featured</a></li>
                                        <li><a href="#">New Arrivals</a></li>
                                        <li><a href="#">Best Sellers</a></li>
                                    </div>
                                </ul>
                            </nav>
                        </div>
                        <!-- Header Bottom Menu Area End Here -->
                    </div>
                </div>
                <!-- Header Bottom Area End Here -->
            </header>
            <!-- Header Area End Here -->
            <!-- Begin Breadcrumb Area -->
            <div class="breadcrumb-area">
                <div class="container">
                    <div class="breadcrumb-content">
                        <ul>
                            <li><a href="index.html">Home</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Breadcrumb Area End Here -->
            <!-- Begin Content Wrapper Area -->
            <div class="content-wrapper mb-50">
                <div class="container">
                    <div class="row">
                        <div class="col-3">
                            <div class="card">
                                <article class="filter-group">
                                    <header class="card-header">
                                        <h6 class="title">Manufacturers</h6>
                                    </header>
                                    <div class="filter-content" id="filter-manufacturer">
                                        <div class="card-body">
                                            <!-- manufacturer options will be inserted here -->
                                        </div> <!-- card-body.// -->
                                    </div>
                                </article>
                                <article class="filter-group">
                                    <header class="card-header">
                                        <h6 class="title">Price Range</h6>
                                    </header>
                                    <div class="filter-content" id="filter-price-range">
                                        <div class="card-body">
                                            <!-- pricee range options will be inserted here -->
                                        </div> <!-- card-body.// -->
                                    </div>
                                </article>
                                <article class="filter-group">
                                    <header class="card-header">
                                        <h6 class="title">Ratings</h6>
                                    </header>
                                    <div class="filter-content" id="filter-ratings">
                                        <div class="card-body">
                                            <!-- ratings options will be inserted here -->
                                        </div> <!-- card-body.// -->
                                    </div>
                                </article>
                            </div> <!-- card.// -->
                        </div>
                        <div class="col-9">
                            <div class="shop-top-bar">
                                <div>
                                    <h2>
                                        Showing 
                                        <span style="font-weight: bold;" id="subcategory-name"></span>
                                        <span id="in-text"></span>
                                        <span style="font-weight: bold;" id="category-name"></span> 
                                        (<span id="item-count"></span> items)
                                    </h2>
                                </div>
                                <div class="quantity-select">
                                    <label>Sort by</label>
                                    <select>
                                        <option>Relevance</option>
                                        <option>Price: Low to High</option>
                                        <option>Price: High to Low</option>
                                        <option>Newest Arrivals</option>
                                    </select>
                                </div>
                            </div>
                            <div class="shop-products-wrapper">
                                <div class="shop-product-area">
                                    <div class="row">
                                        <!-- products will be inserted here -->
                                    </div>
                                </div>
                            </div>
                            <div class="paginatoin-area">
                                <div class="row">
                                    <div class="col-6">
                                    </div>
                                    <div class="col-6">
                                        <ul class="pagination-box">
                                            <!-- pagination navigation will be inserted here -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                             <!-- Begin Brand Area -->
                             <div class="product-area brand-area" style="padding: 20px;">
                                <div class="container">
                                    <div class="row">
                                        <div class="brands-active owl-carousel">
                                            <!-- //brands will be inserted here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Brand Area End here -->
                        </div>
                    </div>
                    
                </div>
            </div>
            <!-- Content Wrapper Area End Here -->
            <!-- Begin Footer Area -->
            <div class="footer">
                <!-- Begin Footer Static Top Area -->
                <div class="footer-static-top">
                    <div class="container">
                        <!-- Begin Footer Shipping Area -->
                        <div class="footer-shipping pt-60 pb-55 pb-xs-25">
                            <div class="row">
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-sm-55 pb-xs-55">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="images/shipping-icon/1.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>Free Delivery</h2>
                                            <p>And free returns. See checkout for delivery dates.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-sm-55 pb-xs-55">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="images/shipping-icon/2.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>Safe Payment</h2>
                                            <p>Pay with the world's most popular and secure payment methods.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-xs-30">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="images/shipping-icon/3.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>Shop with Confidence</h2>
                                            <p>Our Buyer Protection covers your purchasefrom click to delivery.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-xs-30">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="images/shipping-icon/4.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>24/7 Help Center</h2>
                                            <p>Have a question? Call a Specialist or chat online.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                            </div>
                        </div>
                        <!-- Footer Shipping Area End Here -->
                    </div>
                </div>
                <!-- Footer Static Top Area End Here -->
            </div>
            <!-- Footer Area End Here -->
        </div>
        <!-- Body Wrapper End Here -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha512-jGsMH83oKe9asCpkOVkBnUrDDTp8wl+adkB2D+//JtlxO4SrLoJdhbOysIFQJloQFD+C4Fl1rMsQZF76JjV0eQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdn.usebootstrap.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js" integrity="sha512-bPs7Ae6pVvhOSiIcyUClR7/q2OAsRiovw4vAkX+zJbw3ShAeeqezq50RIIcIURq7Oa20rW2n2q+fyXBNcU9lrw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="js/jquery.meanmenu.min.js"></script>
        <script src="js/main.js"></script>
        <script>
            const params = new URLSearchParams(window.location.search);
            const categoryId = params.get('categoryId');
            const subcategoryId = params.get('subcategoryId');
            const categoryName = params.get('categoryName');
            const subcategoryName = params.get('subcategoryName');

            let selectedPage;
            let selectedManufacturers;
            let selectedPriceRange;
            let selectedRatings;
            let totalPages;

            document.addEventListener('DOMContentLoaded', function () {

                checkSignInStatus();
                getCartNumber();

                // Get the  b list
                let breadcrumbList = document.querySelector('.breadcrumb-content ul');
                if (subcategoryName) {
                    let categoryLi = document.createElement('li');
                    categoryLi.innerHTML = `<a href="category.html?categoryId=${params.get('categoryId')}&categoryName=${encodeURIComponent(categoryName)}">${categoryName}</a>`;
                    breadcrumbList.appendChild(categoryLi);

                    let subcategoryLi = document.createElement('li');
                    subcategoryLi.textContent = subcategoryName;
                    subcategoryLi.style.color = '#808080';
                    breadcrumbList.appendChild(subcategoryLi);
                } else if (categoryName) {
                    let categoryLi = document.createElement('li');
                    categoryLi.textContent = categoryName;
                    categoryLi.style.color = '#808080';
                    breadcrumbList.appendChild(categoryLi);
                }

                // fetch and render products
                if (sessionStorage.getItem('selectedPage')) {
                    selectedPage = sessionStorage.getItem('selectedPage');
                } else {
                    selectedPage = 0;
                }
                if (sessionStorage.getItem('selectedPriceRange')) {
                    selectedPriceRange = JSON.parse(sessionStorage.getItem('selectedPriceRange'));
                } else {
                    selectedPriceRange = {
                        label: 'All',
                        minValue: 0,
                        maxValue: Number.MAX_SAFE_INTEGER
                    };
                }
                if (sessionStorage.getItem('selectedRatings')) {
                    selectedRatings = parseInt(sessionStorage.getItem('selectedRatings')); 
                } else {
                    selectedRatings = 1;
                }
                if (sessionStorage.getItem('selectedManufacturers')) {
                    selectedManufacturers = JSON.parse(sessionStorage.getItem('selectedManufacturers'));

                    fetchAndRenderProducts(selectedPage, selectedManufacturers, selectedPriceRange, selectedRatings);
                    setFilterGroupManufacturer(selectedManufacturers);
                    setFilterGroupPriceRange(selectedPriceRange);
                    setFilterGroupRatings(selectedRatings);

                } else {
                    let apiURL;
                    if (subcategoryId !== null) {
                        apiURL = `http://localhost:8080/products/manufacturers?categoryId=${categoryId}&subcategoryId=${subcategoryId}`;
                    } else {
                        apiURL = `http://localhost:8080/products/manufacturers?categoryId=${categoryId}`;
                    }
                    fetch(apiURL)
                        .then(response => response.json())
                        .then(data => {
                            selectedManufacturers = data.reduce((acc, manufacturer) => {
                                acc[manufacturer] = true;
                                return acc;
                            }, {});
                            
                            fetchAndRenderProducts(selectedPage, selectedManufacturers, selectedPriceRange, selectedRatings);
                            setFilterGroupManufacturer(selectedManufacturers);
                            setFilterGroupPriceRange(selectedPriceRange);
                            setFilterGroupRatings(selectedRatings);  

                        })
                        .catch(error => {
                            console.error(error);
                        });
                }

                // get available brands
                fetch(`http://localhost:8080/products/manufacturers?categoryId=${categoryId}`)
                    .then(response => response.json())
                    .then(data => {
                        const brandsContainer = document.querySelector('.brand-area .owl-carousel');
                        brandsContainer.innerHTML = '';

                        data.forEach(manufacturer => {
                            const brandElement = document.createElement('div');
                            brandElement.innerHTML = `
                                <img src="images/logo/manufacturer's logo/${manufacturer}.jpg" title="${manufacturer}" style="width: 50%;">
                            `;

                            brandsContainer.appendChild(brandElement);
                        });
                        initializeOwlCarousel(brandsContainer);
                    })
                    .catch(error => {
                        console.error(error);
                    });
                
                sessionStorage.removeItem('selectedPage');
                sessionStorage.removeItem('selectedManufacturers');
                sessionStorage.removeItem('selectedPriceRange');
                sessionStorage.removeItem('selectedRatings');
            });
        
            function fetchAndRenderProducts(selectedPage, selectedManufacturers, selectedPriceRange, selectedRatings) {
                const params = new URLSearchParams(window.location.search);
                const categoryId = params.get('categoryId');
                const subcategoryId = params.get('subcategoryId');
        
                let apiURL = `http://localhost:8080/products?categoryId=${categoryId}&page=${selectedPage}&size=9`;

                // Check if subcategoryId is present and append to the URL
                if (subcategoryId !== null) {
                    apiURL += `&subcategoryId=${subcategoryId}`;
                }

                // append price range
                apiURL += `&minPrice=${selectedPriceRange.minValue}&maxPrice=${selectedPriceRange.maxValue}`;

                // Check if manufacturers are selected and append to the URL
                const trueSelectedManufacturers = Object.keys(selectedManufacturers).filter(manufacturer => selectedManufacturers[manufacturer]);
                apiURL += `&manufacturers=${trueSelectedManufacturers.join(',')}`;

                apiURL += `&ratings=${selectedRatings}`;

                fetch(apiURL)
                    .then(response => response.json())
                    .then(data => {

                        // Set all manufacturers to false initially
                        Object.keys(selectedManufacturers).forEach(manufacturer => {
                            selectedManufacturers[manufacturer] = false;
                        });

                        // set fetched products summary
                        let categoryNameElement = document.querySelector('#category-name');
                        let itemCountElement = document.querySelector('#item-count');
                        let inTextElement = document.querySelector('#in-text');

                        categoryNameElement.textContent = categoryName;
                        itemCountElement.textContent = data.totalElements;

                        if (subcategoryId) {
                            let subcategoryNameElement = document.querySelector('#subcategory-name');
                            subcategoryNameElement.textContent = subcategoryName;
                            inTextElement.textContent = ' in ';
                        } else {
                            inTextElement.textContent = '';
                        }

                        // populate product grid
                        const productsContainer = document.querySelector('.shop-product-area .row');
                        productsContainer.innerHTML = '';
        
                        data.content.forEach(product => {
                            const productElement = document.createElement('div');
                            productElement.className = 'col-4';
                    
                            let starRating = generateStarRatings(product.ratings);
                    
                            productElement.innerHTML = `
                                <div class="single-product-wrap">
                                    <div class="product-image">
                                        <a href="product-details.html?product=${product.id}">
                                            <img src="images/product/large-size/${product.name}.jpg">
                                            <div class="product-tag-container">
                                                ${product.productTag.newArrival ? '<div class="product-tag new-arrival">New Arrival</div>' : ''}
                                                ${product.productTag.bestSeller ? '<div class="product-tag best-seller">Best Seller</div>' : ''}
                                            </div>
                                        </a>
                                    </div>
                                    <div class="product-desc">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span class="product-manufacturer">${product.manufacturer}</span>
                                            <span class="star-rating">${starRating}<span class="rating-number" style="margin-left: 5px; font-size: 12px;">${product.ratings}</span></span>
                                        </div>
                                        <hr>
                                        <p class="product-name"><a href="product-details.html?product=${product.id}">${product.name}</a></p>
                                        <hr>
                                        <span class="product-price">$ ${product.price.toFixed(2)}</span>
                                    </div>
                                </div>
                            `;

                            productsContainer.appendChild(productElement);
                            
                            // update selectedManufacturers based on returned products
                            if (product.manufacturer in selectedManufacturers) {
                                selectedManufacturers[product.manufacturer] = true;
                                console.log('brand found');
                            } else {
                                selectedManufacturers[product.manufacturer] = false;
                            }
                        });
                        
                        // pagination
                        const paginationBox = document.querySelector('.pagination-box');
                        totalPages = data.totalPages;
        
                        paginationBox.innerHTML = `<li><a href="#" class="Previous"><i class="fa fa-chevron-left"></i> Previous</a></li>`;
                    
                        for (let i = 1; i <= totalPages; i++) {
                            if (i === parseInt(selectedPage) + 1) {
                                // Add a border to the current page number
                                paginationBox.innerHTML += `<li class="current-page"><a href="#">${i}</a></li>`;
                            } else {
                                paginationBox.innerHTML += `<li><a href="#">${i}</a></li>`;
                            }
                        }
        
                        paginationBox.innerHTML += `<li><a href="#" class="Next"> Next <i class="fa fa-chevron-right"></i></a></li>`;
                        
                        let prevButton = document.querySelector('.Previous');
                        let nextButton = document.querySelector('.Next');

                        if (selectedPage == 0) {
                            prevButton.style.color = '#c8c8c8';
                            prevButton.style.pointerEvents = 'none';
                        }
                        if (selectedPage == totalPages - 1) {
                            nextButton.style.color = '#c8c8c8';
                            nextButton.style.pointerEvents = 'none';
                        }
                        paginationBox.addEventListener('click', handlePaginationClick);

                        console.log(selectedManufacturers);
                    })
                    .catch(error => {
                        console.error(error);
                    });
            }

            function setFilterGroupManufacturer(selectedManufacturers) {
                let filterGroup = document.querySelector('#filter-manufacturer .card-body');

                // Clear the existing content
                filterGroup.innerHTML = '';

                let html = '';

                Object.keys(selectedManufacturers).forEach(manufacturer => {
                    const isChecked = selectedManufacturers[manufacturer]; 
                    html += `
                        <label class="filter-label">
                            <input type="checkbox" class="input-manufacturer" data-manufacturer="${manufacturer}" ${isChecked ? 'checked' : ''}>
                            <span>${manufacturer}</span>
                        </label>
                    `;
                });

                filterGroup.innerHTML = html;

                // Add event listener to checkboxes
                const checkboxes = document.querySelectorAll('input[type="checkbox"].input-manufacturer');
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        
                        const pageNumber = 0;
                        setSessionStatus(pageNumber);
                        location.reload();
                    });
                });
            }

            function setFilterGroupPriceRange(selectedPriceRange) {
                
                let filterGroup = document.querySelector('#filter-price-range .card-body');

                // Clear the existing content
                filterGroup.innerHTML = '';

                let html = '';

                // Data for price ranges
                const priceRanges = [
                    { id: 'all', label: 'All', minValue: 0, maxValue: Number.MAX_SAFE_INTEGER },
                    { id: 'less-than-25', label: 'Less than $25', minValue: 0, maxValue: 25 },
                    { id: '25-to-50', label: '$25 - $50', minValue: 25, maxValue: 50 },
                    { id: '50-to-100', label: '$50 - $100', minValue: 50, maxValue: 100 },
                    { id: '100-to-200', label: '$100 - $200', minValue: 100, maxValue: 200 },
                    { id: 'more-than-200', label: 'More than $200', minValue: 200, maxValue: Number.MAX_SAFE_INTEGER }
                ];
                priceRanges.forEach((priceRange) => {
                    const isChecked = priceRange.label === selectedPriceRange.label;

                    html += `
                        <label class="filter-label">
                            <input type="radio" name="priceRange" id="${priceRange.id}" class="input-price-range" data-price-range="${priceRange.label}" data-min-value="${priceRange.minValue}" data-max-value="${priceRange.maxValue}" ${isChecked ? 'checked' : ''}>
                            <span style="position: relative; bottom: 4px;">${priceRange.label}</span>
                        </label>
                    `;
                });

                filterGroup.innerHTML = html;

                // Add event listener to radio buttons
                const radioButtons = document.querySelectorAll('input[type="radio"].input-price-range');
                radioButtons.forEach(radio => {
                    radio.addEventListener('change', () => {
                        
                        const pageNumber = 0;
                        setSessionStatus(pageNumber);
                        location.reload();
                    });
                });
            }

            function setFilterGroupRatings(selectedRatings) {
                
                let filterGroup = document.querySelector('#filter-ratings .card-body');

                // Clear the existing content
                filterGroup.innerHTML = '';

                let html = '';

                // Data for star ratings
                const ratingsOptions = [5, 4, 3, 2, 1];
                const checkedRating = selectedRatings; // Replace with your actual variable for the checked rating

                ratingsOptions.forEach((rating) => {
                    const isChecked = rating === checkedRating;

                    html += `
                        <label class="filter-label">
                            <input type="radio" name="ratings" class="input-ratings" data-ratings="${rating}" ${isChecked ? 'checked' : ''}>
                            <span style="position: relative; bottom: 5px;">${generateStarRatings(rating)} ${rating < 5 ? '& up' : ''}</span>
                        </label>
                    `;
                });

                filterGroup.innerHTML = html;

                // Add event listener to radio buttons
                const radioButtons = document.querySelectorAll('input[type="radio"].input-ratings');
                radioButtons.forEach(radio => {
                    radio.addEventListener('change', () => {
                        
                        const pageNumber = 0;
                        setSessionStatus(pageNumber);
                        location.reload();
                    });
                });
            }

            function generateStarRatings(ratings) {
                // Generate star rating
                let starRating = '';
                const numberOfStars = 5;
                const filledStars = Math.floor(ratings);
                const hasHalfStar = ratings % 1 !== 0;

                for (let i = 1; i <= numberOfStars; i++) {
                    let star = document.createElement('span');
                    star.className = 'star';
                    star.textContent = '★';

                    if (i <= filledStars) {
                        // Full star
                    } else if (i === filledStars + 1 && hasHalfStar) {
                        // Half star
                        star.classList.add('half');
                    } else {
                        // Empty star
                        star.classList.add('empty');
                    }

                    starRating += star.outerHTML;
                }

                return starRating;
            }

            function handlePaginationClick(event) {
                event.preventDefault();

                if (event.target.tagName === 'A') {
                    const pageNumber = parseInt(event.target.textContent);

                    if (!isNaN(pageNumber)) {
                        
                        setSessionStatus(pageNumber - 1);
                        location.reload();
                
                    } else if (event.target.classList.contains('Previous')) {

                        if (selectedPage > 0) { 
                            
                            setSessionStatus(Number(selectedPage) - 1);
                            location.reload();
                        }
                    } else if (event.target.classList.contains('Next')) {

                        if (selectedPage < totalPages - 1) {
                            
                            setSessionStatus(Number(selectedPage) + 1);
                            location.reload();
                        }
                    }
                }
            }

            function setSessionStatus(pageNumber) {
                
                // get the selected manufacturers
                const allManufacturers = Array.from(document.querySelectorAll('input[type="checkbox"].input-manufacturer')).map(checkbox => checkbox.getAttribute('data-manufacturer'));
                const selectedManufacturers = allManufacturers.filter(manufacturer =>
                    document.querySelector(`input[data-manufacturer="${manufacturer}"]:checked`)
                );
                const manufacturerStatus = {};
                allManufacturers.forEach(manufacturer => {
                    manufacturerStatus[manufacturer] = selectedManufacturers.includes(manufacturer);
                });

                // get the selected price range
                let selectedPriceRange = {
                    label: Array.from(document.querySelectorAll('input[type="radio"].input-price-range')).find(radio => radio.checked)?.getAttribute('data-price-range'),
                    minValue: Array.from(document.querySelectorAll('input[type="radio"].input-price-range')).find(radio => radio.checked)?.getAttribute('data-min-value'),
                    maxValue: Array.from(document.querySelectorAll('input[type="radio"].input-price-range')).find(radio => radio.checked)?.getAttribute('data-max-value')
                };

                // Get the selected ratings
                const selectedRatings = Array.from(document.querySelectorAll('input[type="radio"].input-ratings')).find(radio => radio.checked)?.getAttribute('data-ratings');

                sessionStorage.setItem('selectedPage', pageNumber);
                sessionStorage.setItem('selectedManufacturers', JSON.stringify(manufacturerStatus));
                sessionStorage.setItem('selectedPriceRange', JSON.stringify(selectedPriceRange));
                sessionStorage.setItem('selectedRatings', selectedRatings);
            }
         </script>
        <script>
            function initializeOwlCarousel(productsContainer) {
                $(productsContainer).trigger('destroy.owl.carousel');

                // $(productsContainer).owlCarousel().trigger('add.owl.carousel').trigger('refresh.owl.carousel');
                $(productsContainer).owlCarousel({
                    loop: true,
                    nav: true,
                    dots: false,
                    autoplay: false,
                    autoplayTimeout: 5000,
                    navText: ["<i class='fa fa-angle-left'></i>", "<i class='fa fa-angle-right'></i>"],
                    item: 5,
                    responsive: {
                        0: {
                            items: 1
                        },
                        480: {
                            items: 2
                        },
                        768: {
                            items: 3
                        },
                        992: {
                            items: 4
                        },
                        1200: {
                            items: 5
                        }
                    }
                });
            }
        </script>
    </body>
</html>
