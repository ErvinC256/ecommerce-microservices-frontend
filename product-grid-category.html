<!doctype html>
<html class="no-js" lang="zxx">
    <head>
        <title>eCommerce.com</title>
        <link rel="icon" type="image/png" href="images/logo/site-logo-only.jpg">
        <!-- MATERIAL DESIGN ICONIC FONT -->
		<link rel="stylesheet" href="fonts/material-design-iconic-font/css/material-design-iconic-font.min.css">
        <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.css" integrity="sha512-UTNP5BXLIptsaj5WdKFrkFov94lDx+eBvbKyoe1YAfjeRPC+gT5kyZ10kOHCfNZqEui1sxmqvodNUx3KbuYI/A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdn.usebootstrap.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <link rel="stylesheet" href="css/helper.css">
        <link rel="stylesheet" href="style.css">       
    </head>
    <body>
        <!-- Begin Body Wrapper -->
        <div class="body-wrapper">
            <!-- Begin Header Area -->
            <header class="header">
                <!-- Begin Header Top Area -->
                <div class="header-top">
                    <div class="container">
                        <div class="ht-menu">
                            <span>Telephone Enquiry:(+123) 123 321 345</span>
                            <ul>
                                <li><a href="index.html">Home</a></li>
                                <li><a href="account-personal-info.html">My Account</a></li>
                                <li><a href="shopping-cart.html">Cart</a></li>
                                <li><a href="checkout.html">Checkout</a></li>
                                <li><a id="sign-in-link" href="sign-in.html">Sign In</a></li>    
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Header Top Area End Here -->
                <!-- Begin Header Middle Area -->
                <div class="header-middle">
                    <div class="container">
                        <div class="row">
                            <div class="col-3">
                                <div class="logo">
                                    <a href="index.html">
                                        <img src="images/logo/site-logo-only.jpg" alt="" style="width: 18%;">
                                        <span>eCommerce</span> 
                                    </a>
                                </div>
                            </div>
                            <div class="col-9">
                                <div class="hm-searchbox-area">
                                    <div class="hm-searchbox">
                                        <form id="searchForm">
                                            <select id="categorySelect">
                                                <option value="0">All</option>                         
                                                <option value="1">Laptops & Tablets</option>                     
                                                <option value="2">Electronics & Accessories</option>    
                                                <option value="3">Printers</option>
                                            </select>
                                            <input id="searchInput" type="text" placeholder="Search for anything at eCommerce online">
                                        </form>                                                                           
                                    </div>
                                    <p><a href="account.html">Hello, <span id="greet-user">guest</span></a></p>
                                    <div class="cart-container">
                                        <a href="shopping-cart.html">
                                            <img src="images/icon/cart.png" alt="" width="50px">
                                            <span id="cart-number" class="cart-number">0</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Header Middle Area End Here -->
                <!-- Begin Header Bottom Area -->
                <div class="header-bottom header-sticky">
                    <div class="container">
                        <div class="hb-menu">
                            <nav>
                                <ul>
                                    <li class="dropdown-holder"><a href="product-grid-category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets">Laptops & Tablets</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="product-grid-category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets&subcategoryId=1&subcategoryName=Laptops">Laptops</a></li>
                                            <li><a href="product-grid-category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets&subcategoryId=2&subcategoryName=Tablets">Tablets</a></li>
                                        </ul>
                                    </li>
                                    <li class="dropdown-holder"><a href="product-grid-category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories">Electronics & Accessories</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="product-grid-category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=3&subcategoryName=Keyboards%20%26%20Mice">Keyboards & Mice</a></li>
                                            <li><a href="product-grid-category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=4&subcategoryName=Audio">Audio</a></li>
                                            <li><a href="product-grid-category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=5&subcategoryName=Hard%20Drives,%20SSDs%20%26%20Storage">Hard Drives, SSDs & Storage</a></li>
                                        </ul>
                                    </li>
                                    <li class="dropdown-holder"><a href="product-grid-category.html?categoryId=3&categoryName=Printers">Printers</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="product-grid-category.html?categoryId=3&categoryName=Printers&subcategoryId=6&subcategoryName=Inkjet%20Printers">Inkjet Printers</a></li>
                                            <li><a href="product-grid-category.html?categoryId=3&categoryName=Printers&subcategoryId=7&subcategoryName=Laser%20Printers">Laser Printers</a></li>
                                        </ul>
                                    </li>
                                    <div class="hb-right">
                                        <li><a href="product-grid-general.html?searchType=New%20Arrivals">New Arrivals</a></li>
                                        <li><a href="product-grid-general.html?searchType=Best%20Sellers">Best Sellers</a></li>
                                    </div>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
                <!-- Header Bottom Area End Here -->
            </header>
            <!-- Header Area End Here -->
            <!-- Begin Breadcrumb Area -->
            <div class="breadcrumb-area mb-20">
                <div class="container">
                    <div class="breadcrumb-content">
                        <ul>
                            <li><a href="index.html">Home</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Breadcrumb Area End Here -->
            <!-- Begin Content Wrapper Area -->
            <div class="content-wrapper mb-50">
                <div class="container">
                    <div class="row">
                        <div class="col-3">
                            <div class="card">
                                <article class="filter-group">
                                    <header class="card-header">
                                        <a href="#" data-toggle="collapse" data-target="#filter-manufacturer" aria-expanded="true">
                                            <div style="width: 20px;">
                                                <i class="icon-control fa fa-caret-down"></i>
                                            </div>
                                            <h6 class="title">Manufacturer</h6>
                                        </a>
                                    </header>
                                    <div class="filter-content collapse show" id="filter-manufacturer">
                                        <div class="card-body">
                                            <!-- manufacturer options will be inserted here -->
                                        </div>
                                    </div>
                                </article>
                                <article class="filter-group">
                                    <header class="card-header">
                                        <a href="#" data-toggle="collapse" data-target="#filter-price-range" aria-expanded="true">
                                            <div style="width: 20px;">
                                                <i class="icon-control fa fa-caret-down"></i>
                                            </div>
                                            <h6 class="title">Price Range</h6>
                                        </a>
                                    </header>
                                    <div class="filter-content collapse show" id="filter-price-range">
                                        <div class="card-body">
                                            <!-- price range options will be inserted here -->
                                        </div>
                                    </div>
                                </article>
                                <article class="filter-group">
                                    <header class="card-header">
                                        <a href="#" data-toggle="collapse" data-target="#filter-ratings" aria-expanded="true">
                                            <div style="width: 20px;">
                                                <i class="icon-control fa fa-caret-down"></i>
                                            </div>
                                            <h6 class="title">Ratings</h6>
                                        </a>
                                    </header>
                                    <div class="filter-content collapse show" id="filter-ratings">
                                        <div class="card-body">
                                            <!-- ratings options will be inserted here -->
                                        </div>
                                    </div>
                                </article>
                            </div> <!-- card.// -->
                        </div>
                        <div class="col-9">
                            <div class="shop-top-bar">
                                <div>
                                    <h2>
                                        Showing 
                                        <span style="font-weight: bold;" id="subcategory-name"></span>
                                        <span id="in-text"></span>
                                        <span style="font-weight: bold;" id="category-name"></span> 
                                        <span style="color: gray; padding-left: 10px;"><span id="item-count"></span> items</span> 
                                    </h2>
                                </div>
                                <div class="quantity-select">
                                    <label>Sort by</label>
                                        <select>
                                            <option value="relevance">Relevance</option>
                                            <option value="price,asc">Price: Low to High</option>
                                            <option value="price,desc">Price: High to Low</option>
                                            <option value="name,asc">Name: A to Z</option>
                                            <option value="name,desc">Name: Z to A</option>
                                        </select>
                                </div>
                            </div>
                            <div class="shop-products-wrapper">
                                <div class="shop-product-area">
                                    <div class="row">
                                        <!-- products will be inserted here -->
                                    </div>
                                </div>
                            </div>
                            <div class="paginatoin-area">
                                <div class="row">
                                    <div class="col-6">
                                    </div>
                                    <div class="col-6">
                                        <ul class="pagination-box">
                                            <!-- pagination navigation will be inserted here -->
                                        </ul>
                                    </div>
                                </div>
                            </div>
                             <!-- Begin Brand Area -->
                             <div class="brand-area" style="padding: 20px;">
                                <div class="container">
                                    <div class="row">
                                        <div class="brands-active owl-carousel">
                                            <!-- //brands will be inserted here -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Brand Area End here -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- Content Wrapper Area End Here -->
            <!-- Begin Scroll Top  -->
            <div id="scrollToTop" class="mt-100">
                back to top
            </div>
            <!-- Scroll Top End Here -->
            <!-- Begin Footer Area -->
            <div class="footer pt-20 pb-20">
                <div class="container">
                    <div class="footer-wrap">
                        <div>
                            <ul>
                                <li><a href="help-center.html">Terms & Conditions</a></li>
                                <li><a href="#">New products</a></li>
                                <li><a href="#">Best sales</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                                <li><a href="#">Delivery</a></li>
                                <li><a href="#">Legal Notice</a></li>
                                <li><a href="#">About us</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                                <li><a href="#">Prices drop</a></li>
                                <li><a href="#">New products</a></li>
                                <li><a href="#">Best sales</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                                <li><a href="#">Delivery</a></li>
                                <li><a href="#">Legal Notice</a></li>
                                <li><a href="#">About us</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                                <li><a href="#">Prices drop</a></li>
                                <li><a href="#">New products</a></li>
                                <li><a href="#">Best sales</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                                <li><a href="#">Delivery</a></li>
                                <li><a href="#">Legal Notice</a></li>
                                <li><a href="#">About us</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                            </ul>
                        </div>   
                        <div>
                            <span style="font-size: 12px;">&copy 2024 eCommerce.com. All Rights Reserved.</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer Area End Here -->
        </div>
        <!-- Body Wrapper End Here -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha512-jGsMH83oKe9asCpkOVkBnUrDDTp8wl+adkB2D+//JtlxO4SrLoJdhbOysIFQJloQFD+C4Fl1rMsQZF76JjV0eQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdn.usebootstrap.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js" integrity="sha512-bPs7Ae6pVvhOSiIcyUClR7/q2OAsRiovw4vAkX+zJbw3ShAeeqezq50RIIcIURq7Oa20rW2n2q+fyXBNcU9lrw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="js/jquery.meanmenu.min.js"></script>
        <script src="js/main.js"></script>
        <script>
            const params = new URLSearchParams(window.location.search);
            const categoryId = params.get('categoryId');
            const subcategoryId = params.get('subcategoryId');
            const categoryName = params.get('categoryName');
            const subcategoryName = params.get('subcategoryName');

            let selectedManufacturers;
            let selectedPriceRange;
            let selectedRatings;
            let selectedPage;
            let totalPages;
            let selectedSortOption;

            document.addEventListener('DOMContentLoaded', function () {

                checkSignInStatus();
                getCartNumber();

                // Get the  b list
                let breadcrumbList = document.querySelector('.breadcrumb-content ul');
                if (subcategoryName) {
                    let categoryLi = document.createElement('li');
                    categoryLi.innerHTML = `<a href="product-grid-category.html?categoryId=${params.get('categoryId')}&categoryName=${encodeURIComponent(categoryName)}">${categoryName}</a>`;
                    breadcrumbList.appendChild(categoryLi);

                    let subcategoryLi = document.createElement('li');
                    subcategoryLi.textContent = subcategoryName;
                    subcategoryLi.style.color = '#808080';
                    breadcrumbList.appendChild(subcategoryLi);
                } else if (categoryName) {
                    let categoryLi = document.createElement('li');
                    categoryLi.textContent = categoryName;
                    categoryLi.style.color = '#808080';
                    breadcrumbList.appendChild(categoryLi);
                }

                // fetch and render products
                if (sessionStorage.getItem('selectedPriceRange')) {
                    selectedPriceRange = JSON.parse(sessionStorage.getItem('selectedPriceRange'));
                } else {
                    selectedPriceRange = {
                        label: 'All',
                        minValue: 0,
                        maxValue: Number.MAX_SAFE_INTEGER
                    };
                }
                if (sessionStorage.getItem('selectedRatings')) {
                    selectedRatings = parseInt(sessionStorage.getItem('selectedRatings')); 
                } else {
                    selectedRatings = 1;
                }
                if (sessionStorage.getItem('selectedPage')) {
                    selectedPage = parseInt(sessionStorage.getItem('selectedPage'));
                } else {
                    selectedPage = 0;
                }
                if (sessionStorage.getItem('selectedSortOption')) {
                    selectedSortOption = sessionStorage.getItem('selectedSortOption');
                } else {
                    selectedSortOption = 'relevance';
                }
                if (sessionStorage.getItem('selectedManufacturers')) {
                    selectedManufacturers = JSON.parse(sessionStorage.getItem('selectedManufacturers'));

                    fetchAndRenderProducts(selectedManufacturers, selectedPriceRange, selectedRatings, selectedPage, selectedSortOption);
                    setFilterGroupManufacturer(selectedManufacturers);
                    setFilterGroupPriceRange(selectedPriceRange);
                    setFilterGroupRatings(selectedRatings);
                    setSortSelectOption(selectedSortOption);

                } else {
                    let apiURL;
                    if (subcategoryId !== null) {
                        apiURL = `http://localhost:8080/products/manufacturers?categoryId=${categoryId}&subcategoryId=${subcategoryId}`;
                    } else {
                        apiURL = `http://localhost:8080/products/manufacturers?categoryId=${categoryId}`;
                    }
                    fetch(apiURL)
                        .then(response => response.json())
                        .then(data => {
                            selectedManufacturers = data.reduce((acc, manufacturer) => {
                                acc[manufacturer] = true;
                                return acc;
                            }, {});
                            
                            fetchAndRenderProducts(selectedManufacturers, selectedPriceRange, selectedRatings, selectedPage, selectedSortOption);
                            setFilterGroupManufacturer(selectedManufacturers);
                            setFilterGroupPriceRange(selectedPriceRange);
                            setFilterGroupRatings(selectedRatings);  
                            setSortSelectOption(selectedSortOption);

                        })
                        .catch(error => {
                            console.error(error);
                        });
                }

                // get available brands
                // fetch(`http://localhost:8080/products/manufacturers?categoryId=${categoryId}`)
                //     .then(response => response.json())
                //     .then(data => {
                //         const brandsContainer = document.querySelector('.brand-area .owl-carousel');
                //         brandsContainer.innerHTML = '';

                //         data.forEach(manufacturer => {
                //             const brandElement = document.createElement('div');
                //             brandElement.innerHTML = `
                //                 <img src="images/logo/manufacturer's logo/${manufacturer}.jpg" title="${manufacturer}" style="width: 50%;">
                //             `;

                //             brandsContainer.appendChild(brandElement);
                //         });
                //         initializeOwlCarousel(brandsContainer);
                //     })
                //     .catch(error => {
                //         console.error(error);
                //     });
                
                sessionStorage.removeItem('selectedManufacturers');
                sessionStorage.removeItem('selectedPriceRange');
                sessionStorage.removeItem('selectedRatings');
                sessionStorage.removeItem('selectedPage');
                sessionStorage.removeItem('selectedSortOption');
            });
        
            function fetchAndRenderProducts(selectedManufacturers, selectedPriceRange, selectedRatings, selectedPage, selectedSortOption) {
        
                let apiURL = `http://localhost:8080/products?`;

                apiURL += `&categoryId=${categoryId}`;

                if (subcategoryId !== null) {
                    apiURL += `&subcategoryId=${subcategoryId}`;
                }

                apiURL += `&minPrice=${selectedPriceRange.minValue}&maxPrice=${selectedPriceRange.maxValue}`;

                const trueSelectedManufacturers = Object.keys(selectedManufacturers).filter(manufacturer => selectedManufacturers[manufacturer]);
                apiURL += `&manufacturers=${trueSelectedManufacturers.join(',')}`;

                apiURL += `&ratings=${selectedRatings}`;

                apiURL += `&page=${selectedPage}&size=9`;

                if (selectedSortOption !== 'relevance') {
                    apiURL += `&sort=${selectedSortOption}`;
                }

                fetch(apiURL)
                    .then(response => response.json())
                    .then(data => {

                        // Set all manufacturers to false initially
                        Object.keys(selectedManufacturers).forEach(manufacturer => {
                            selectedManufacturers[manufacturer] = false;
                        });

                        // set fetched products summary
                        let categoryNameElement = document.querySelector('#category-name');
                        let itemCountElement = document.querySelector('#item-count');
                        let inTextElement = document.querySelector('#in-text');

                        categoryNameElement.textContent = categoryName;
                        itemCountElement.textContent = data.totalElements;

                        if (subcategoryId) {
                            let subcategoryNameElement = document.querySelector('#subcategory-name');
                            subcategoryNameElement.textContent = subcategoryName;
                            inTextElement.textContent = ' in ';
                        } else {
                            inTextElement.textContent = '';
                        }

                        // populate product grid
                        const productsContainer = document.querySelector('.shop-product-area .row');
                        productsContainer.innerHTML = '';

                        if (data.content.length === 0) {
                            const messageElement = document.createElement('div');
                            messageElement.className = 'col-12';
                            messageElement.style.textAlign = 'center';

                            messageElement.innerHTML = '<p style="font-size: 16px; color: gray; padding: 20px;">No items found</p>';
                        
                            productsContainer.appendChild(messageElement);
                        }
                        data.content.forEach(product => {
                            const productElement = document.createElement('div');
                            productElement.className = 'col-4';
                    
                            let starRating = generateStarRatings(product.ratings);
                    
                            productElement.innerHTML = `
                                <div class="single-product-wrap">
                                    <div class="product-image">
                                        <a href="product-details.html?product=${product.id}">
                                            <img src="images/product/large-size/${product.name}.jpg">
                                            <div class="product-tag-container">
                                                ${product.productTag.newArrival ? '<div class="product-tag new-arrival">New Arrival</div>' : ''}
                                                ${product.productTag.bestSeller ? '<div class="product-tag best-seller">Best Seller</div>' : ''}
                                            </div>
                                        </a>
                                    </div>
                                    <div class="product-desc">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span class="product-manufacturer">${product.manufacturer}</span>
                                            <span class="star-rating">${starRating}<span class="rating-number" style="margin-left: 5px; font-size: 12px;">${product.ratings}</span></span>
                                        </div>
                                        <hr>
                                        <p class="product-name"><a href="product-details.html?product=${product.id}">${product.name}</a></p>
                                        <hr>
                                        <span class="product-price">$ ${product.price.toFixed(2)}</span>
                                    </div>
                                </div>
                            `;

                            productsContainer.appendChild(productElement);
                        });
                        
                        // pagination
                        const paginationBox = document.querySelector('.pagination-box');
                        totalPages = data.totalPages;
        
                        paginationBox.innerHTML = `<li><a href="#" class="Previous"><i class="fa fa-chevron-left"></i> Previous</a></li>`;
                    
                        for (let i = 1; i <= totalPages; i++) {
                            if (i === parseInt(selectedPage) + 1) {
                                // Add a border to the current page number
                                paginationBox.innerHTML += `<li class="current-page"><a href="#">${i}</a></li>`;
                            } else {
                                paginationBox.innerHTML += `<li><a href="#">${i}</a></li>`;
                            }
                        }
        
                        paginationBox.innerHTML += `<li><a href="#" class="Next"> Next <i class="fa fa-chevron-right"></i></a></li>`;
                        
                        let prevButton = document.querySelector('.Previous');
                        let nextButton = document.querySelector('.Next');

                        if (selectedPage == 0) {
                            prevButton.style.color = '#c8c8c8';
                            prevButton.style.pointerEvents = 'none';
                        }
                        if (selectedPage == totalPages - 1) {
                            nextButton.style.color = '#c8c8c8';
                            nextButton.style.pointerEvents = 'none';
                        }
                        paginationBox.addEventListener('click', handlePaginationClick);

                    })
                    .catch(error => {
                        console.error(error);
                    });
            }

            function setFilterGroupManufacturer(selectedManufacturers) {
                let filterGroup = document.querySelector('#filter-manufacturer .card-body');

                // Clear the existing content
                filterGroup.innerHTML = '';

                let html = '';

                Object.keys(selectedManufacturers).forEach(manufacturer => {
                    const isChecked = selectedManufacturers[manufacturer]; 
                    html += `
                        <label class="filter-label">
                            <input type="checkbox" class="input-manufacturer" data-manufacturer="${manufacturer}" ${isChecked ? 'checked' : ''}>
                            <span>${manufacturer}</span>
                        </label>
                    `;
                });

                filterGroup.innerHTML = html;

                // Add event listener to checkboxes
                const checkboxes = document.querySelectorAll('input[type="checkbox"].input-manufacturer');
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        
                        const pageNumber = 0;
                        const sortOption = 'relevance';
                        setSessionStatus(pageNumber, sortOption);
                        location.reload();
                    });
                });
            }

            function setFilterGroupPriceRange(selectedPriceRange) {
                
                let filterGroup = document.querySelector('#filter-price-range .card-body');

                // Clear the existing content
                filterGroup.innerHTML = '';

                let html = '';

                // Data for price ranges
                const priceRanges = [
                    { id: 'all', label: 'All', minValue: 0, maxValue: Number.MAX_SAFE_INTEGER },
                    { id: 'less-than-25', label: 'Less than $25', minValue: 0, maxValue: 25 },
                    { id: '25-to-50', label: '$25 - $50', minValue: 25, maxValue: 50 },
                    { id: '50-to-100', label: '$50 - $100', minValue: 50, maxValue: 100 },
                    { id: '100-to-200', label: '$100 - $200', minValue: 100, maxValue: 200 },
                    { id: 'more-than-200', label: 'More than $200', minValue: 200, maxValue: Number.MAX_SAFE_INTEGER }
                ];
                priceRanges.forEach((priceRange) => {
                    const isChecked = priceRange.label === selectedPriceRange.label;

                    html += `
                        <label class="filter-label">
                            <input type="radio" name="priceRange" id="${priceRange.id}" class="input-price-range" data-price-range="${priceRange.label}" data-min-value="${priceRange.minValue}" data-max-value="${priceRange.maxValue}" ${isChecked ? 'checked' : ''}>
                            <span>${priceRange.label}</span>
                        </label>
                    `;
                });

                filterGroup.innerHTML = html;

                // Add event listener to radio buttons
                const radioButtons = document.querySelectorAll('input[type="radio"].input-price-range');
                radioButtons.forEach(radio => {
                    radio.addEventListener('change', () => {
                        
                        const pageNumber = 0;
                        const sortOption = 'relevance';
                        setSessionStatus(pageNumber, sortOption);
                        location.reload();
                    });
                });
            }

            function setFilterGroupRatings(selectedRatings) {
                
                let filterGroup = document.querySelector('#filter-ratings .card-body');

                // Clear the existing content
                filterGroup.innerHTML = '';

                let html = '';

                // Data for star ratings
                const ratingsOptions = [5, 4, 3, 2, 1];
                const checkedRating = selectedRatings; // Replace with your actual variable for the checked rating

                ratingsOptions.forEach((rating) => {
                    const isChecked = rating === checkedRating;

                    html += `
                        <label class="filter-label">
                            <input type="radio" name="ratings" class="input-ratings" data-ratings="${rating}" ${isChecked ? 'checked' : ''}>
                            <span>${generateStarRatings(rating)} ${rating < 5 ? '& up' : ''}</span>
                        </label>
                    `;
                });

                filterGroup.innerHTML = html;

                // Add event listener to radio buttons
                const radioButtons = document.querySelectorAll('input[type="radio"].input-ratings');
                radioButtons.forEach(radio => {
                    radio.addEventListener('change', () => {
                        
                        const pageNumber = 0;
                        const sortOption = 'relevance';
                        setSessionStatus(pageNumber, sortOption);
                        location.reload();
                    });
                });
            }

            function setSortSelectOption(selectedSortOption) {
                // Get the select element
                const selectElement = document.querySelector('.shop-top-bar select');

                // Find the option with the matching value and set it as selected
                for (const option of selectElement.options) {
                    if (option.value === selectedSortOption) {
                        option.selected = true;
                        break;
                    }
                }

                // Add event listener to the select element
                selectElement.addEventListener('change', () => {
                    const selectedSortOption = selectElement.value;

                    console.log(selectedSortOption);
                    const pageNumber = 0;
                    setSessionStatus(pageNumber, selectedSortOption);
                    location.reload();
                });
            }

            function generateStarRatings(ratings) {
                // Generate star rating
                let starRating = '';
                const numberOfStars = 5;
                const filledStars = Math.floor(ratings);
                const hasHalfStar = ratings % 1 !== 0;

                for (let i = 1; i <= numberOfStars; i++) {
                    let star = document.createElement('span');
                    star.className = 'star';
                    star.textContent = '★';

                    if (i <= filledStars) {
                        // Full star
                    } else if (i === filledStars + 1 && hasHalfStar) {
                        // Half star
                        star.classList.add('half');
                    } else {
                        // Empty star
                        star.classList.add('empty');
                    }

                    starRating += star.outerHTML;
                }

                return starRating;
            }

            function handlePaginationClick(event) {
                event.preventDefault();

                if (event.target.tagName === 'A') {
                    const pageNumber = parseInt(event.target.textContent);

                    if (!isNaN(pageNumber)) {
                        
                        setSessionStatus(pageNumber - 1, selectedSortOption);
                        location.reload();
                
                    } else if (event.target.classList.contains('Previous')) {

                        if (selectedPage > 0) { 
                            
                            setSessionStatus(Number(selectedPage) - 1, selectedSortOption);
                            location.reload();
                        }
                    } else if (event.target.classList.contains('Next')) {

                        if (selectedPage < totalPages - 1) {
                            
                            setSessionStatus(Number(selectedPage) + 1, selectedSortOption);
                            location.reload();
                        }
                    }
                }
            }

            function setSessionStatus(pageNumber, sortOption) {
                
                // get the selected manufacturers
                const allManufacturers = Array.from(document.querySelectorAll('input[type="checkbox"].input-manufacturer')).map(checkbox => checkbox.getAttribute('data-manufacturer'));
                const selectedManufacturers = allManufacturers.filter(manufacturer =>
                    document.querySelector(`input[data-manufacturer="${manufacturer}"]:checked`)
                );
                const manufacturerStatus = {};
                allManufacturers.forEach(manufacturer => {
                    manufacturerStatus[manufacturer] = selectedManufacturers.includes(manufacturer);
                });

                // get the selected price range
                let selectedPriceRange = {
                    label: Array.from(document.querySelectorAll('input[type="radio"].input-price-range')).find(radio => radio.checked)?.getAttribute('data-price-range'),
                    minValue: Array.from(document.querySelectorAll('input[type="radio"].input-price-range')).find(radio => radio.checked)?.getAttribute('data-min-value'),
                    maxValue: Array.from(document.querySelectorAll('input[type="radio"].input-price-range')).find(radio => radio.checked)?.getAttribute('data-max-value')
                };

                // Get the selected ratings
                const selectedRatings = Array.from(document.querySelectorAll('input[type="radio"].input-ratings')).find(radio => radio.checked)?.getAttribute('data-ratings');
                
                sessionStorage.setItem('selectedManufacturers', JSON.stringify(manufacturerStatus));
                sessionStorage.setItem('selectedPriceRange', JSON.stringify(selectedPriceRange));
                sessionStorage.setItem('selectedRatings', selectedRatings);
                sessionStorage.setItem('selectedPage', pageNumber);
                sessionStorage.setItem('selectedSortOption', sortOption);
            }
        </script>
        <script>
            function initializeOwlCarousel(productsContainer) {
                $(productsContainer).trigger('destroy.owl.carousel');

                // $(productsContainer).owlCarousel().trigger('add.owl.carousel').trigger('refresh.owl.carousel');
                $(productsContainer).owlCarousel({
                    loop: true,
                    nav: true,
                    dots: false,
                    autoplay: false,
                    autoplayTimeout: 5000,
                    navText: ["<i class='fa fa-angle-left'></i>", "<i class='fa fa-angle-right'></i>"],
                    item: 5,
                    responsive: {
                        0: {
                            items: 1
                        },
                        480: {
                            items: 2
                        },
                        768: {
                            items: 3
                        },
                        992: {
                            items: 4
                        },
                        1200: {
                            items: 5
                        }
                    }
                });
            }
        </script>
        <script>
            // Select all the filter groups
            let filterGroups = document.querySelectorAll('.filter-group');

            // Add event listener to each filter group
            filterGroups.forEach((group) => {
                let header = group.querySelector('.card-header a');
                let icon = header.querySelector('.icon-control');

                // Toggle the arrow direction on click
                header.addEventListener('click', () => {
                    if (icon.classList.contains('fa-caret-down')) {
                        icon.classList.remove('fa-caret-down');
                        icon.classList.add('fa-caret-right');
                    } else {
                        icon.classList.remove('fa-caret-right');
                        icon.classList.add('fa-caret-down');
                    }
                });
            });
        </script>
    </body>
</html>
