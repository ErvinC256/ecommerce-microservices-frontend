<!doctype html>
<html class="no-js" lang="zxx">
    <head>
        <title>E-Commerce.com</title>
        <link rel="icon" type="image/png" href="images/icon/cart.png">
        <!-- MATERIAL DESIGN ICONIC FONT -->
		<link rel="stylesheet" href="fonts/material-design-iconic-font/css/material-design-iconic-font.min.css">
        <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.css" integrity="sha512-UTNP5BXLIptsaj5WdKFrkFov94lDx+eBvbKyoe1YAfjeRPC+gT5kyZ10kOHCfNZqEui1sxmqvodNUx3KbuYI/A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdn.usebootstrap.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <link rel="stylesheet" href="css/helper.css">
        <link rel="stylesheet" href="style.css">       
    </head>
    <body>
        <!-- Begin Body Wrapper -->
        <div class="body-wrapper">
            <!-- Begin Header Area -->
            <header class="header">
                <!-- Begin Header Top Area -->
                <div class="header-top">
                    <div class="container">
                        <div class="ht-menu">
                            <span>Telephone Enquiry:(+123) 123 321 345</span>
                            <ul>
                                <li><a href="index.html">Home</a></li>
                                <li><a href="account.html">My Account</a></li>
                                <li><a href="shopping-cart.html">Cart</a></li>
                                <li><a href="checkout.html">Checkout</a></li>
                                <li><a id="sign-in-link" href="sign-in.html">Sign In</a></li>    
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Header Top Area End Here -->
                <!-- Begin Header Middle Area -->
                <div class="header-middle">
                    <div class="container">
                        <div class="row">
                            <div class="col-3">
                                <div class="logo">
                                    <a href="index.html">
                                        <img src="images/logo/site-logo.jpg" alt="">
                                    </a>
                                </div>
                            </div>
                            <div class="col-9">
                                <div class="hm-searchbox-area">
                                    <div class="hm-searchbox">
                                        <form action="#">
                                            <select>
                                                <option value="0">All</option>                         
                                                <option value="10">Laptops & Tablets</option>                     
                                                <option value="10">Electronics & Accessories</option>    
                                                <option value="10">Printers</option>
                                            </select>
                                            <input type="text" placeholder="Enter search key ...">
                                        </form>
                                    </div>
                                    <p><a href="account.html">Hello, <span id="greet-user">guest</span></a></p>
                                    <div class="cart-container">
                                        <a href="shopping-cart.html">
                                            <img src="images/icon/cart.png" alt="" width="50px">
                                            <span id="cart-number" class="cart-number">0</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Header Middle Area End Here -->
                <!-- Begin Header Bottom Area -->
                <div class="header-bottom header-sticky">
                    <div class="container">
                        <div class="hb-menu">
                            <nav>
                                <ul>
                                    <li class="dropdown-holder"><a href="product-grid-category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets">Laptops & Tablets</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="product-grid-category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets&subcategoryId=1&subcategoryName=Laptops">Laptops</a></li>
                                            <li><a href="product-grid-category.html?categoryId=1&categoryName=Laptops%20%26%20Tablets&subcategoryId=2&subcategoryName=Tablets">Tablets</a></li>
                                        </ul>
                                    </li>
                                    <li class="dropdown-holder"><a href="product-grid-category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories">Electronics & Accessories</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="product-grid-category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=3&subcategoryName=Keyboards%20%26%20Mice">Keyboards & Mice</a></li>
                                            <li><a href="product-grid-category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=4&subcategoryName=Audio">Audio</a></li>
                                            <li><a href="product-grid-category.html?categoryId=2&categoryName=Electronics%20%26%20Accessories&subcategoryId=5&subcategoryName=Hard%20Drives,%20SSDs%20%26%20Storage">Hard Drives, SSDs & Storage</a></li>
                                        </ul>
                                    </li>
                                    <li class="dropdown-holder"><a href="product-grid-category.html?categoryId=3&categoryName=Printers">Printers</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="product-grid-category.html?categoryId=3&categoryName=Printers&subcategoryId=6&subcategoryName=Inkjet%20Printers">Inkjet Printers</a></li>
                                            <li><a href="product-grid-category.html?categoryId=3&categoryName=Printers&subcategoryId=7&subcategoryName=Laser%20Printers">Laser Printers</a></li>
                                        </ul>
                                    </li>
                                    <div class="hb-right">
                                        <li><a href="#">Featured</a></li>
                                        <li><a href="#">New Arrivals</a></li>
                                        <li><a href="#">Best Sellers</a></li>
                                    </div>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>
                <!-- Header Bottom Area End Here -->
            </header>
            <!-- Header Area End Here -->
            <!-- Begin Breadcrumb Area -->
            <div class="breadcrumb-area mb-20">
                <div class="container">
                    <div class="breadcrumb-content">
                        <ul>
                            <li><a href="index.html">Home</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Breadcrumb Area End Here -->
            <!-- Begin Content Wrapper Area -->
            <div class="content-wrapper mb-50">
                <div class="container">
                    <div class="shop-top-bar">
                        <div>
                            <h2>
                                Showing 
                                <span style="font-weight: bold;" id="subcategory-name"></span>
                                <span id="in-text"></span>
                                <span style="font-weight: bold;" id="category-name"></span> 
                                (<span id="item-count"></span> items)
                            </h2>
                        </div>
                        <div class="quantity-select">
                            <label>Sort by</label>
                            <select>
                                <option>Relevance</option>
                                <option>Price: Low to High</option>
                                <option>Price: High to Low</option>
                                <option>Newest Arrivals</option>
                            </select>
                        </div>
                    </div>
                    <div class="shop-products-wrapper">
                        <div class="shop-product-area">
                            <div class="row">
                                <!-- products will be inserted here -->
                            </div>
                        </div>
                    </div>
                    <div class="paginatoin-area">
                        <div class="row">
                            <div class="col-6">
                            </div>
                            <div class="col-6">
                                <ul class="pagination-box">
                                    <!-- pagination navigation will be inserted here -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Content Wrapper Area End Here -->
            <!-- Begin Scroll Top  -->
            <div id="scrollToTop" class="mt-100">
                back to top
            </div>
            <!-- Scroll Top End Here -->
            <!-- Begin Footer Area -->
            <div class="footer pt-20 pb-20">
                <div class="container">
                    <div class="footer-wrap">
                        <div>
                            <ul>
                                <li><a href="help-center.html">Terms & Conditions</a></li>
                                <li><a href="#">New products</a></li>
                                <li><a href="#">Best sales</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                                <li><a href="#">Delivery</a></li>
                                <li><a href="#">Legal Notice</a></li>
                                <li><a href="#">About us</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                                <li><a href="#">Prices drop</a></li>
                                <li><a href="#">New products</a></li>
                                <li><a href="#">Best sales</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                                <li><a href="#">Delivery</a></li>
                                <li><a href="#">Legal Notice</a></li>
                                <li><a href="#">About us</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                                <li><a href="#">Prices drop</a></li>
                                <li><a href="#">New products</a></li>
                                <li><a href="#">Best sales</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                                <li><a href="#">Delivery</a></li>
                                <li><a href="#">Legal Notice</a></li>
                                <li><a href="#">About us</a></li>
                                <li><a href="contact.html">Contact us</a></li>
                            </ul>
                        </div>   
                        <div>
                            <span style="font-size: 12px;">&copy 2024 E-Commerce. All Rights Reserved.</span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Footer Area End Here -->
        </div>
        <!-- Body Wrapper End Here -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha512-jGsMH83oKe9asCpkOVkBnUrDDTp8wl+adkB2D+//JtlxO4SrLoJdhbOysIFQJloQFD+C4Fl1rMsQZF76JjV0eQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdn.usebootstrap.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js" integrity="sha512-bPs7Ae6pVvhOSiIcyUClR7/q2OAsRiovw4vAkX+zJbw3ShAeeqezq50RIIcIURq7Oa20rW2n2q+fyXBNcU9lrw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="js/jquery.meanmenu.min.js"></script>
        <script src="js/main.js"></script>
        <script>
            // Parse the URL query parameters
            const urlParams = new URLSearchParams(window.location.search);
            const searchTerm = urlParams.get('searchTerm');
            const categoryId = urlParams.get('categoryId');

            let selectedPage;
            let totalPages;

            document.addEventListener('DOMContentLoaded', function () {

                checkSignInStatus();
                getCartNumber();

                // fetch and render products
                if (sessionStorage.getItem('selectedPage')) {
                    selectedPage = sessionStorage.getItem('selectedPage');
                } else {
                    selectedPage = 0;
                }
                
            });

            function fetchAndRenderProducts(searchTerm, selectedPage) {
        
                let apiURL = `http://localhost:8080/products/search?searchTerm=${searchTerm}&categoryId=${categoryId}&page=${selectedPage}&size=9`;

                fetch(apiURL)
                    .then(response => response.json())
                    .then(data => {

                        // populate product grid
                        const productsContainer = document.querySelector('.shop-product-area .row');
                        productsContainer.innerHTML = '';
        
                        data.content.forEach(product => {
                            const productElement = document.createElement('div');
                            productElement.className = 'col-4';
                    
                            let starRating = generateStarRatings(product.ratings);
                    
                            productElement.innerHTML = `
                                <div class="single-product-wrap">
                                    <div class="product-image">
                                        <a href="product-details.html?product=${product.id}">
                                            <img src="images/product/large-size/${product.name}.jpg">
                                            <div class="product-tag-container">
                                                ${product.productTag.newArrival ? '<div class="product-tag new-arrival">New Arrival</div>' : ''}
                                                ${product.productTag.bestSeller ? '<div class="product-tag best-seller">Best Seller</div>' : ''}
                                            </div>
                                        </a>
                                    </div>
                                    <div class="product-desc">
                                        <div style="display: flex; justify-content: space-between;">
                                            <span class="product-manufacturer">${product.manufacturer}</span>
                                            <span class="star-rating">${starRating}<span class="rating-number" style="margin-left: 5px; font-size: 12px;">${product.ratings}</span></span>
                                        </div>
                                        <hr>
                                        <p class="product-name"><a href="product-details.html?product=${product.id}">${product.name}</a></p>
                                        <hr>
                                        <span class="product-price">$ ${product.price.toFixed(2)}</span>
                                    </div>
                                </div>
                            `;

                            productsContainer.appendChild(productElement);
                        });
                        
                        // pagination
                        const paginationBox = document.querySelector('.pagination-box');
                        totalPages = data.totalPages;
        
                        paginationBox.innerHTML = `<li><a href="#" class="Previous"><i class="fa fa-chevron-left"></i> Previous</a></li>`;
                    
                        for (let i = 1; i <= totalPages; i++) {
                            if (i === parseInt(selectedPage) + 1) {
                                // Add a border to the current page number
                                paginationBox.innerHTML += `<li class="current-page"><a href="#">${i}</a></li>`;
                            } else {
                                paginationBox.innerHTML += `<li><a href="#">${i}</a></li>`;
                            }
                        }
        
                        paginationBox.innerHTML += `<li><a href="#" class="Next"> Next <i class="fa fa-chevron-right"></i></a></li>`;
                        
                        let prevButton = document.querySelector('.Previous');
                        let nextButton = document.querySelector('.Next');

                        if (selectedPage == 0) {
                            prevButton.style.color = '#c8c8c8';
                            prevButton.style.pointerEvents = 'none';
                        }
                        if (selectedPage == totalPages - 1) {
                            nextButton.style.color = '#c8c8c8';
                            nextButton.style.pointerEvents = 'none';
                        }
                        paginationBox.addEventListener('click', handlePaginationClick);

                        console.log(selectedManufacturers);
                    })
                    .catch(error => {
                        console.error(error);
                    });
            }

            function generateStarRatings(ratings) {
                // Generate star rating
                let starRating = '';
                const numberOfStars = 5;
                const filledStars = Math.floor(ratings);
                const hasHalfStar = ratings % 1 !== 0;

                for (let i = 1; i <= numberOfStars; i++) {
                    let star = document.createElement('span');
                    star.className = 'star';
                    star.textContent = '★';

                    if (i <= filledStars) {
                        // Full star
                    } else if (i === filledStars + 1 && hasHalfStar) {
                        // Half star
                        star.classList.add('half');
                    } else {
                        // Empty star
                        star.classList.add('empty');
                    }

                    starRating += star.outerHTML;
                }

                return starRating;
            }

            function handlePaginationClick(event) {
                event.preventDefault();

                if (event.target.tagName === 'A') {
                    const pageNumber = parseInt(event.target.textContent);

                    if (!isNaN(pageNumber)) {
                        
                        setSessionStatus(pageNumber - 1);
                        location.reload();
                
                    } else if (event.target.classList.contains('Previous')) {

                        if (selectedPage > 0) { 
                            
                            setSessionStatus(Number(selectedPage) - 1);
                            location.reload();
                        }
                    } else if (event.target.classList.contains('Next')) {

                        if (selectedPage < totalPages - 1) {
                            
                            setSessionStatus(Number(selectedPage) + 1);
                            location.reload();
                        }
                    }
                }
            }

            function setSessionStatus(pageNumber) {

                sessionStorage.setItem('selectedPage', pageNumber);
                sessionStorage.setItem('searchTerm', searchTerm);
            }
        </script>
    </body>
</html>
