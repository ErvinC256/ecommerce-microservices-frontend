<!doctype html>
<html class="no-js" lang="zxx">
    <head>
        <title>E-Commerce</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.css" integrity="sha512-UTNP5BXLIptsaj5WdKFrkFov94lDx+eBvbKyoe1YAfjeRPC+gT5kyZ10kOHCfNZqEui1sxmqvodNUx3KbuYI/A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdn.usebootstrap.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <link rel="stylesheet" href="css/helper.css">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
    <!--[if lt IE 8]>
		<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
	<![endif]-->
        <!-- Begin Body Wrapper -->
        <div class="body-wrapper">
            <!-- Begin Header Area -->
            <header class="header">
                <!-- Begin Header Top Area -->
                <div class="header-top">
                    <div class="container">
                        <div class="ht-menu">
                            <span>Telephone Enquiry:(+123) 123 321 345</span>
                            <ul>
                                <li><a href="index.html">Home</a></li>
                                <li><a href="account.html">My Account</a></li>
                                <li><a href="shopping-cart.html">Cart</a></li>
                                <li><a href="checkout.html">Checkout</a></li>
                                <li><a id="sign-in-link" href="sign-in.html">Sign In</a></li>    
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- Header Top Area End Here -->
                <!-- Begin Header Middle Area -->
                <div class="header-middle">
                    <div class="container">
                        <div class="row">
                            <div class="col-3">
                                <div class="logo">
                                    <a href="index.html">
                                        <img src="images/logo/site-logo.jpg" alt="">
                                    </a>
                                </div>
                            </div>
                            <div class="col-9 hm-searchbox-area">
                                <div class="hm-searchbox">
                                    <form action="#">
                                        <select>
                                            <option value="0">All</option>                         
                                            <option value="10">Laptops & Tablets</option>                     
                                            <option value="10">Electronics & Accessories</option>    
                                            <option value="10">Printers</option>
                                        </select>
                                        <input type="text" placeholder="Enter your search key ...">
                                    </form>
                                </div>
                                <p>Hello, <span id="greet-user">guest</span></p>
                                <div class="cart-container">
                                    <a href="shopping-cart.html">
                                        <img src="images/icon/cart.png" alt="" width="50px">
                                        <span id="cart-number" class="cart-number">50</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Header Middle Area End Here -->
                <!-- Begin Header Bottom Area -->
                <div class="header-bottom header-sticky">
                    <div class="container">
                        <!-- Begin Header Bottom Menu Area -->
                        <div class="hb-menu">
                            <nav>
                                <ul>
                                    <li class="dropdown-holder"><a href="category.html?categoryId=1">Laptops & Tablets</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="category.html?categoryId=1&subcategoryId=1">Laptops</a></li>
                                            <li><a href="category.html?categoryId=1&subcategoryId=2">Tablets</a></li>
                                        </ul>
                                    </li>
                                    <li class="dropdown-holder"><a href="category.html?categoryId=2">Electronics & Accessories</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="category.html?categoryId=2&subcategoryId=3">Keyboards & Mice</a></li>
                                            <li><a href="category.html?categoryId=2&subcategoryId=4">Audio</a></li>
                                            <li><a href="category.html?categoryId=2&subcategoryId=5">Hard Drives, SSDs & Storage</a></li>
                                        </ul>
                                    </li>
                                    <li class="dropdown-holder"><a href="category.html?categoryId=3">Printers</a>
                                        <ul class="hb-dropdown">
                                            <li><a href="category.html?categoryId=3&subcategoryId=6">Inkjet Printers</a></li>
                                            <li><a href="category.html?categoryId=3&subcategoryId=7">Laser Printers</a></li>
                                        </ul>
                                    </li>
                                    <div class="hb-right">
                                        <li><a href="#">Featured</a></li>
                                        <li><a href="#">New Arrivals</a></li>
                                        <li><a href="#">Best Sellers</a></li>
                                    </div>
                                </ul>
                            </nav>
                        </div>
                        <!-- Header Bottom Menu Area End Here -->
                    </div>
                </div>
                <!-- Header Bottom Area End Here -->
            </header>
            <!-- Header Area End Here -->
            <!-- Begin Breadcrumb Area -->
            <div class="breadcrumb-area">
                <div class="container">
                    <div class="breadcrumb-content">
                        <ul>
                            <li><a href="index.html">Home</a></li>
                            <li style="color: #808080;">Shopping Cart</li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- Breadcrumb Area End Here -->
            <!-- Begin Cart Contents Area -->
            <div class="cart-contents-area mb-50">
                <div class="container">
                    <div class="row">
                        <div class="col-8">
                            <div class="section-title">
                                <h2>Shopping Cart</h2>
                                <p style="float: right;">Last Updated: <span id="last-updated"></span></p>
                            </div><br><br>
                            <div class="cart-contents">
                                <table class="cart-table">
                                    <tr>
                                        <th>Item</th>
                                        <th style="text-align: right">Price</th>
                                    </tr>
                                    <!-- cart items will be inserted here -->
                                </table>
                                <br>
                                <div>
                                    <button class="my-button-inverse" id="clear-cart">Clear Cart</button>
                                </div>
                            </div>
                        </div>
                        <div class="col-4">
                            <div class="basket-summary-container">
                                <div class="basket-row">
                                    <!-- <div>Subtotal <span>(2 items)</span></div> -->
                                    <div>Subtotal <span>(<span id="item-count">0</span> items)</span></div>
                                    <div>RM <span id="subtotal">0.00</span></div>
                                </div>
                                <hr>
                                <div style="text-align: right;">
                                    <button class="my-button">Proceed to Checkout</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Cart Contents Area End Here -->
            <!-- Begin Footer Area -->
            <div class="footer">
                <!-- Begin Footer Static Top Area -->
                <div class="footer-static-top">
                    <div class="container">
                        <!-- Begin Footer Shipping Area -->
                        <div class="footer-shipping pt-60 pb-55 pb-xs-25">
                            <div class="row">
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-sm-55 pb-xs-55">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="images/shipping-icon/1.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>Free Delivery</h2>
                                            <p>And free returns. See checkout for delivery dates.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-sm-55 pb-xs-55">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="images/shipping-icon/2.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>Safe Payment</h2>
                                            <p>Pay with the world's most popular and secure payment methods.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-xs-30">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="images/shipping-icon/3.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>Shop with Confidence</h2>
                                            <p>Our Buyer Protection covers your purchasefrom click to delivery.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                                <!-- Begin Li's Shipping Inner Box Area -->
                                <div class="col-lg-3 col-md-6 col-sm-6 pb-xs-30">
                                    <div class="li-shipping-inner-box">
                                        <div class="shipping-icon">
                                            <img src="images/shipping-icon/4.png" alt="Shipping Icon">
                                        </div>
                                        <div class="shipping-text">
                                            <h2>24/7 Help Center</h2>
                                            <p>Have a question? Call a Specialist or chat online.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Li's Shipping Inner Box Area End Here -->
                            </div>
                        </div>
                        <!-- Footer Shipping Area End Here -->
                    </div>
                </div>
                <!-- Footer Static Top Area End Here -->
            </div>
            <!-- Footer Area End Here -->
        </div>
        <!-- Body Wrapper End Here -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha512-jGsMH83oKe9asCpkOVkBnUrDDTp8wl+adkB2D+//JtlxO4SrLoJdhbOysIFQJloQFD+C4Fl1rMsQZF76JjV0eQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdn.usebootstrap.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js" integrity="sha512-bPs7Ae6pVvhOSiIcyUClR7/q2OAsRiovw4vAkX+zJbw3ShAeeqezq50RIIcIURq7Oa20rW2n2q+fyXBNcU9lrw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="js/jquery.meanmenu.min.js"></script>
        <script src="js/main.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {

                checkSignInStatus();

                const userId = sessionStorage.getItem('userId');

                fetch(`http://localhost:8080/carts/${userId}`) 
                .then(response => {
                    return response.json();
                })
                .then(data => {
                    const cartTable = document.querySelector('.cart-table');
                    const dateElement = document.querySelector('#last-updated');
                    const lastUpdated = new Date(data.lastUpdated);

                    const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };
                    const formattedDate = lastUpdated.toLocaleDateString('en-US', options);

                    dateElement.textContent = formattedDate;

                    if (data.cartItemDetails.length === 0) {
                        const messageRow = document.createElement('tr');
                        messageRow.innerHTML = '<p style="font-size: 18px; text-align: center;">Your cart is empty</p>';
                        cartTable.appendChild(messageRow);
                        return;
                    }

                    data.cartItemDetails.forEach(cartItem => {
                        const cartItemElement = document.createElement('tr');
                        let selectOptions = '';
                        for(let i = 1; i <= cartItem.quantityInStock; i++) {
                            selectOptions += `<option value="${i}" ${i === cartItem.quantity ? 'selected' : ''}>Quantity: ${i}</option>`;
                        }
                        cartItemElement.innerHTML = `
                            <td>
                                <div class="row">
                                    <div class="col-4">
                                        <div class="product-image">
                                            <a href="single-product.html">
                                                <img src="images/product/large-size/${cartItem.name}.jpg" alt="Li's Product Image">
                                            </a>
                                        </div>
                                    </div>
                                    <div class="col-8">
                                        <div class="cart-product-details">
                                            <div>
                                                <p style="font-size: 18px;">${cartItem.name}</p>
                                            </div>
                                            <div>
                                                <div class="quantity-select">
                                                    <p style="font-size: 16px;">Stock Left: ${cartItem.quantityInStock}</p>
                                                    <select>
                                                        ${selectOptions}
                                                    </select>
                                                </div>
                                            </div>
                                            <div>
                                                <ul class="cart-options">
                                                    <li><a href="">Checkout</a></li>
                                                    <li><a href="" class="remove" data-id="${cartItem.cartItemId}">Remove</a></li>
                                                    <li><a href="product-details.html?product=${cartItem.productId}">View Details</a></li>      
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                            <td style="text-align: right; width: 100px;">
                                <p style="font-size: 16px; font-weight: bold;">RM ${cartItem.price.toFixed(2)}</p>
                            </td>
                        `;
                        cartTable.appendChild(cartItemElement);
                    });

                    document.querySelectorAll('.remove').forEach(item => {
                        item.addEventListener('click', function(event) {
                            event.preventDefault();

                            fetch(`http://localhost:8080/carts/${userId}/cart-items/${this.dataset.id}`, {
                                method: 'DELETE',
                            })
                            .then(response => response.json())
                            .then(data => {
                                location.reload();
                            })
                            .catch((error) => {
                                
                            });
                        });
                    });

                    // Update basket summary
                    const itemCountElement = document.getElementById('item-count');
                    const subtotalElement = document.getElementById('subtotal');

                    itemCountElement.textContent = data.cartItemDetails.length;
                    subtotalElement.textContent = data.subtotal.toFixed(2);
                })
                .catch(error => {

                });

                document.getElementById('clear-cart').addEventListener('click', function() {
                    event.preventDefault();

                    const userId = sessionStorage.getItem('userId');

                    fetch(`http://localhost:8080/carts/${userId}/cart-items`, {
                        method: 'DELETE'
                    })
                    .then(response => response.json())
                    .then(data => {
                        location.reload();
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        // Handle the error here
                    });
                });
            });
        </script>
    </body>
</html>
